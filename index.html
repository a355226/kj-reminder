<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<!-- Firebase SDK (compat ç‰ˆï¼Œæœ€ç°¡å–®æ¥) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>


<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="icon" type="image/png" sizes="32x32" href="reminder.png">
<link rel="apple-touch-icon" sizes="180x180" href="reminder.png">
<link rel="manifest" href="manifest.json">

  <title>å¾…è¾¦å°å¹«æ‰‹</title>
  <style>
/* å…¨åŸŸè¼¸å…¥å…ƒä»¶å­—é«”å¤§å° */
input, select, textarea, option {
  font-size: 16px;     /* æ¨è–¦æ‰‹æ©Ÿå®‰å…¨å­—é«”å¤§å°ï¼Œé¿å… iOS è‡ªå‹•æ”¾å¤§ */
  line-height: 1.4;    /* è¡Œé«˜ç¨å¾®åŠ é«˜ä¸€é»ï¼Œé–±è®€æ›´èˆ’æœ */
}
button {
  font-size: 15px;
}

    :root {
      --blue-light: #ebf5fc;
      --green-light: #e6f9f0;
      --yellow-light: #fffbe6;
      --white: #ffffff;
      --gray-text: #444;
      --urgent-color: #ffeaea;
    }
    * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body {
      margin: 0; padding: 1rem; background-color: var(--blue-light);
      color: var(--gray-text); display: flex; justify-content: center;
    }
    .container { width: 100%; max-width: 480px; position: relative; }
    h1 { text-align: center; margin-bottom: 1rem; }
    .section {
      background-color: var(--white); border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
      padding: 1rem; margin-bottom: 1rem;
    }
    .section-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem; }
    .task {
      display: flex; justify-content: space-between; align-items: center;
      background-color: var(--yellow-light); padding: 0.75rem 1rem;
      border-radius: 8px; margin-bottom: 0.5rem; cursor: pointer;
    }
    .task-content { flex: 1; }
    .task-title { font-size: 1.2rem;font-weight: 600; margin-bottom: 0.25rem; }
    .task-due { font-size: 0.85rem; color: #888; }
    .task-days {
      background-color: var(--yellow-light); color: brown;
      border-radius: 50%; padding: 0.4rem 0.6rem; font-size: 0.85rem;
      font-weight: bold; flex-shrink: 0; text-align: center; margin-left: 1rem;
    }
    .fab {
      position: fixed; bottom: 24px; right: 24px; width: 56px; height: 56px;
      background-color: #00aaff; color: white; border-radius: 50%; font-size: 32px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); z-index: 10;
    }
    .menu {
      position: fixed; bottom: 90px; right: 24px; background-color: white;
      border-radius: 10px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      display: none; flex-direction: column; z-index: 9;
    }
    .menu button {
      border: none; background: none; padding: 12px 16px;
      font-size: 14px; text-align: left; cursor: pointer;
    }

    .modal {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background-color: rgba(0, 0, 0, 0.3); display: none;
      justify-content: center; align-items: center; z-index: 20;
    }
    .modal-content {
      background-color: white; padding: 1rem; border-radius: 12px;
      width: 90%; max-width: 400px; position: relative;
    }
    .modal-content label { display: block; margin-top: 0.5rem; font-size: 0.9rem; }
/* åªçµ¦è¼¸å…¥æ¡†/ä¸‹æ‹‰/æ–‡å­—å€ï¼Œæ’é™¤ radio & checkbox */
.modal-content input:not([type="radio"]):not([type="checkbox"]),
.modal-content select,
.modal-content textarea {
  width: 100%;
  padding: 0.5rem;
  margin-top: 0.25rem;
  border: 1px solid #ccc;
  border-radius: 6px;
}

//å„²å­˜æŒ‰éˆ•
.save-btn {
  background-color: #009973;
  color: white;
  border: none;
  padding: 0.5rem;
  border-radius: 6px;
  cursor: pointer;
  margin-bottom: 0.5rem;
  width: 100%;
}
.save-btn:hover {
  background-color: #008060;
}

.modal-content > button {
  margin-top: 1rem;
  width: 100%;
  padding: 0.5rem;
  background-color: #00aaff;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}


.save-btn-half, .delete-btn-half {
  flex: 1;
  padding: 0.5rem;
  border-radius: 6px;
  cursor: pointer;
  width: 50%;
  border: none;
}

.save-btn-half {
  background-color: #77d4bc;
  color: white;
}
.save-btn-half:hover {
  background-color: #008060;
}

.delete-btn-half {
  background-color: #fc9a9a;
  color: white;
}
.delete-btn-half:hover {
  background-color: #cc3333;
}

.close-btn {
  position: absolute;
  top: 12px;
  right: 12px;
  width: 28px;
  height: 28px;
  padding: 0;
  margin: 0;
  border: none;
  border-radius: 50%;
  background-color: #eee;
  color: #333;
  font-size: 16px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.modal-content > .close-btn {
  width: auto;
}

#check-success {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 9999;
  width: 100px;
  height: 100px;
  opacity: 0;
  pointer-events: none;
}

#check-success.show {
  animation: pop-in 1.5s ease forwards;
}

#check-success svg {
  width: 100px;
  height: 100px;
}

.circle {
  stroke: #a2f4c5;
  stroke-width: 4;
  stroke-dasharray: 157;
  stroke-dashoffset: 157;
  animation: draw-circle 0.5s ease-out forwards;
}

.check {
  stroke: #2ecc71;
  stroke-width: 5;
  stroke-linecap: round;
  stroke-linejoin: round;
  stroke-dasharray: 30;
  stroke-dashoffset: 30;
  animation: draw-check 0.3s 0.5s ease-out forwards;
}

@keyframes draw-circle {
  to {
    stroke-dashoffset: 0;
  }
}

@keyframes draw-check {
  to {
    stroke-dashoffset: 0;
  }
}

@keyframes pop-in {
  0% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.5);
    filter: blur(4px);
  }
  40% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1.1);
    filter: blur(0);
  }
  80% {
    transform: translate(-50%, -50%) scale(1);
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.8);
  }
}
.confirm-buttons {
  display: flex;
  gap: 0.75rem;
  margin-top: 1.5rem;
}

.confirm-buttons button {
  flex: 1;
  padding: 0.6rem;
  font-size: 1rem;
  font-weight: bold;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.confirm-btn {
  background-color: #fc9a9a;
  color: white;
}
.confirm-btn:hover {
  background-color: #cc4444;
}

.cancel-btn {
  background-color: #f0f0f0;
  color: #333;
}
.cancel-btn:hover {
  background-color: #ddd;
}

//ç·¨è¼¯åˆ†é¡ç”¨
.section.edit-mode {
  position: relative;
  padding-left: 2.5rem;
}

.section-title {
  position: relative; /* æ–°å¢é€™ä¸€è¡Œè®“å…§éƒ¨çµ•å°å®šä½ç”Ÿæ•ˆ */
  font-size: 1.2rem;
  font-weight: bold;
  margin-bottom: 0.5rem;
}

.drag-handle {
  display: inline-block;
  margin-right: 0.5rem;
  font-size: 1.2rem;
  cursor: grab;
  color: #888;
  vertical-align: middle;
}


.delete-btn {
  position: absolute;
  top: 0;
  right: 0;
  background-color: transparent;
  border: none;
  font-size: 1rem;
  color: #999;
  cursor: pointer;
  display: none;
}
.section.edit-mode .delete-btn {
  display: block;
}

.section.dragging {
  opacity: 0.5;
  background-color: transparent !important;
}

.dragging {
  opacity: 0.6;
  background: #eef8ff;
}


/* é‡å‘½åæŒ‰éˆ• */
/* è®“æ¨™é¡Œæˆä¸€è¡Œæ’åˆ—ï¼šâ˜°ã€æ¨™é¡Œæ–‡å­—ã€âœï¼ˆåˆªé™¤éµä¾ç„¶åœ¨å³ä¸Šè§’çµ•å°å®šä½ï¼‰ */
.section-title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* é‰›ç­†è·Ÿåœ¨æ¨™é¡Œæ–‡å­—å¾Œæ–¹ï¼ˆä¸è¦çµ•å°å®šä½ï¼‰ */
.rename-btn {
  position: static;           /* é‡è¦ï¼šå–æ¶ˆåŸæœ¬çš„ absolute */
  display: none;              /* åªæœ‰ç·¨è¼¯æ¨¡å¼æ‰é¡¯ç¤º */
  background: transparent;
  border: none;
  font-size: 1rem;
  color: #999;
  cursor: pointer;
  margin-left: 0.8rem;
transform: translateY(-2.2px); /* â¬† å¾€ä¸Š 2pxï¼Œå¯è‡ªè¡Œèª¿æ•´ */
  padding: 0;                 /* å–æ¶ˆå°æ–¹å¡Šå¤–æ¡†æ„Ÿ */
}
.section.edit-mode .rename-btn { display: inline-flex; }

/* æ›´å¤šåŠŸèƒ½ï¼ˆä¿®æ­£å¾Œï¼‰*/
/* å³ä¸Šè§’ ... æŒ‰éˆ• */
.more-btn {
  position: fixed;
  top: 12px;
  right: 12px;
  width: 32px;      /* ç¸®å°å¯¬ */
  height: 32px;     /* ç¸®å°é«˜ */
  border-radius: 50%;
  background: #fff;
  color: #555;
  font-size: 18px;  /* å­—é«”ä¹Ÿç¸®å° */
  font-weight: bold;
  display: flex;
  align-items: center;    /* å‚ç›´ç½®ä¸­ */
  justify-content: center;/* æ°´å¹³ç½®ä¸­ */
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  cursor: pointer;
  z-index: 100;
  line-height: 1;         /* ç¢ºä¿æ–‡å­—å‚ç›´å±…ä¸­ */
}



/* æ›´å¤šåŠŸèƒ½ Modal */
#moreModal .modal-content {
  max-width: 300px;
}
.filter-days {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-top: -1rem;
}
.filter-days label {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  font-size: 0.9rem;
}

/* æ­·å²ç´€éŒ„ */
.filter-status {
  display: flex;
  gap: 1rem;    
  margin-top: -1rem;           /* å…©å€‹é¸é …ä¹‹é–“çš„è·é›¢ */
}

.filter-status label {
  display: inline-flex;    /* é—œéµï¼šè®“â—‹å’Œæ–‡å­—åœ¨åŒä¸€è¡Œ */
  align-items: center;
  gap: 0.25rem;            /* â—‹ å’Œæ–‡å­—è·é›¢ */
  white-space: nowrap;     /* ç¦æ­¢æ–‡å­—æ›è¡Œ */
}

/* å¤©æ•¸è¨­å®š */
.filter-mode {
  display: flex;
  gap: 1rem;          /* é¸é …ä¹‹é–“è·é›¢ */
  margin-top: -1rem;  /* è·Ÿä¸Šæ–¹æ¨™é¡Œçš„è·é›¢å¯ä¾éœ€æ±‚èª¿æ•´ */
}

.filter-mode label {
  display: inline-flex;     /* â—‹ å’Œæ–‡å­—åŒä¸€è¡Œ */
  align-items: center;
  gap: 0.25rem;             /* â—‹ å’Œæ–‡å­—è·é›¢ */
  white-space: nowrap;      /* ç¦æ­¢æ›è¡Œ */
}

.logout-btn{
  width:100%;
font-size:15px;
  padding:0.6rem;
  background:#f5f5f5;
  color:#333;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.logout-btn:hover{ background:#eee; }

/* çµ±ä¸€æŠŠæ‰€æœ‰ modal è“‹åœ¨é é¢ä¸Š */
.modal { z-index: 200; }

/* â‹¯ é¸å–®çš„å±¤ç´šç¨ä½ä¸€é» */
#moreModal { z-index: 180; }

/* ç™»å‡ºç¢ºèªå†é«˜ä¸€é»ï¼Œç¢ºä¿æ°¸é åœ¨æœ€ä¸Šé¢ */
#logoutModal { z-index: 220; }

/* ç™»å…¥CSS */
#loginPage{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  background:var(--blue-light);
}

/* ç™½è‰²å¡ç‰‡ï¼šé€™è£¡æ§åˆ¶å¯¬åº¦ã€åœ“è§’ã€é™°å½±ã€å…§è· */
#loginCard{
  position: absolute !important; /* ç„¡è¦–å‰é¢è¨­å®š */
  top: 80px;                      /* å¾€ä¸Š 20pxï¼Œä½ å¯ä»¥æ”¹ */
  left: 50%;
  transform: translateX(-50%);    /* æ°´å¹³ç½®ä¸­ */
  background:var(--white);
  border-radius:12px;          /* â† å¡ç‰‡åœ“è§’ */
  box-shadow:0 2px 6px rgba(0,0,0,0.08); /* â† å¡ç‰‡é™°å½± */
  padding:2rem;                /* â† å¡ç‰‡å…§è· */
  width:95%;
  max-width:450px;
min-height: 500px; /* æœ€å°é«˜åº¦ï¼Œå…§å®¹è¶…éæ™‚æœƒè‡ªå‹•è®Šé«˜ */

}

/* æ¨™é¡Œ */
.login-title{
  text-align:center;
  margin:0 0 1.5rem;
  font-size:28px;              /* â† æ¨™é¡Œå¤§å° */
  font-weight:800;
}

/* label èˆ‡æ¬„ä½çš„é–“è· */
.login-label{
  font-weight:600;
  margin:0.4rem 0 0.4rem;
}

/* è¼¸å…¥æ¡†å¤–è§€ï¼šé«˜åº¦ã€å­—é«”ã€åœ“è§’ã€é‚Šæ¡† */
.login-input{
  width:100%;
  height:44px;                 /* â† æ¬„ä½é«˜åº¦ */
  padding:0 12px;              /* â† æ–‡å­—å·¦å³å…§è· */
  border:1px solid #ccc;
  border-radius:8px;           /* â† æ¬„ä½åœ“è§’ */
  font-size:16px;              /* â† æ¬„ä½å­—é«”å¤§å° */
  margin:0 0 1rem;
margin-top:0.8rem;
  outline:none;
}
.login-input:focus{
  border-color:#95d3ff;
  box-shadow:0 0 0 3px rgba(0,170,255,.15);
}

/* å‹¾é¸åˆ—ï¼ˆcheckbox èˆ‡æ–‡å­—åœ¨åŒä¸€è¡Œï¼‰ */
.login-checkrow{
  display:flex;
  align-items:center;
  gap:.4rem;
  margin:0 0 1rem;
}

/* ç™»å…¥æŒ‰éˆ•å¤–è§€èˆ‡äº’å‹• */
.login-btn{
  width:100%;
  height:46px;                 /* â† æŒ‰éˆ•é«˜åº¦ */
  background:#00aaff;          /* â† æŒ‰éˆ•ä¸»è‰² */
  color:#fff;
  border:none;
  border-radius:8px;           /* â† æŒ‰éˆ•åœ“è§’ */
  font-size:16px;
  cursor:pointer;
}
.login-btn:hover{ background:#0791e6; }
.login-btn:active{ transform:translateY(1px); }

/* åº•ä¸‹ç´…è‰²æç¤º */
.login-tip{
  margin-top:1rem;
  color:#cc4444;
  font-size:0.85rem;           /* â† æç¤ºæ–‡å­—å¤§å° */
  text-align:center;
}

/* å¯é¸ï¼šå°è¢å¹•å†ç¸®ä¸€é» padding */
@media (max-width:360px){
  #loginCard{ padding:1.25rem; }
}

/* å€å¡Šåˆ†é¡ + é‡è¦ å‹¾é¸ åŒè¡Œæ’ç‰ˆ */
.inline-row {
  display: flex;
  align-items: center;
  gap: .75rem;
  margin-top: .25rem;     /* èˆ‡ä¸Šæ–¹ label çš„è·é›¢ */
}

/* ä¸‹æ‹‰é¸å–®ç¸®åˆ°ä¸€åŠå¯¬ã€é å·¦ */
.inline-row .half {
  width: 50%;
  min-width: 160px;       /* è¦–éœ€è¦å¯èª¿æˆ–æ‹¿æ‰ */
}

/* å‹¾é¸çš„å¤–è§€ */
.important-flag {
  display: inline-flex;
  align-items: center;
  gap: .35rem;
  white-space: nowrap;
  font-size: 0.95rem;
}
.drag-handle{
  cursor: grab;
  touch-action: none;          /* é‡é»ï¼šé˜»æ­¢é è¨­æ²å‹• */
  -webkit-user-select: none;   /* iOS ä¸è¦é¸å­— */
  user-select: none;
  -webkit-user-drag: none;
}
/* å¯é¸ï¼šå…§å®¹å€ä»å¯ä¸Šä¸‹æ²å‹• */
.section { touch-action: pan-y; }

  </style>
</head>
<body>
<!-- ç™»éŒ„é é¢ -->
<div id="loginPage">
  <div id="loginCard">
   <h1 style="display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 24px;">
  <img src="https://cdn.jsdelivr.net/gh/a355226/kj-reminder/reminder.png" alt="icon" width="40" style="position: relative; top: 1px;">
  å¾…è¾¦å°å¹«æ‰‹
</h1>

    <label class="login-label">è‡ªè¨‚å¸³è™Ÿ</label>
    <input type="text" id="login-username" class="login-input" placeholder="è«‹è¼¸å…¥å¸³è™Ÿ">

    <label class="login-label">è‡ªè¨‚å¯†ç¢¼</label>
    <input type="password" id="login-password" class="login-input" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">

    <label class="login-checkrow">
      <input type="checkbox" id="auto-login">
      <span>è‡ªå‹•ç™»å…¥</span>
    </label>

    <button id="login-btn" class="login-btn">ç™»å…¥</button>

    <p class="login-tip">å¹³å°å…è¨»å†Šï¼Œè‡ªè¨‚å¸³è™Ÿå¯†ç¢¼å³å¯ç™»éŒ„</p>
  </div>
</div>



  <div class="container" style="display:none">
    <h1 style="display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 24px;">
  <img src="https://cdn.jsdelivr.net/gh/a355226/kj-reminder/reminder.png"
       alt="icon" width="40" style="transform: translateY(2px);">
  å¾…è¾¦å°å¹«æ‰‹
</h1>

<!-- å³ä¸Šè§’ ... æŒ‰éˆ• -->
<div class="more-btn" onclick="openModalById('moreModal')">â‹¯</div>
<div id="section-container">
<div id="doneMore" style="display:none; text-align:right; margin:0.25rem 0;">
  <button id="doneMoreBtn" style="border:0; background:#eee; padding:6px 10px; border-radius:8px; cursor:pointer;">æ›´å¤šâ€¦</button>
  <div id="doneMonthMenu" style="display:none; position:absolute; right:16px; background:#fff; border:1px solid #ddd; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,.08); padding:6px; z-index:50;"></div>
</div>

    <div class="section" id="ç…§é¡§æœå‹™">
      <div class="section-title">ç…§é¡§æœå‹™</div>
    </div>
    <div class="section" id="å°ˆæ¥­æœå‹™">
      <div class="section-title">å°ˆæ¥­æœå‹™</div>
    </div>
    <div class="section" id="äº¤é€šæ¥é€">
      <div class="section-title">äº¤é€šæ¥é€</div>
    </div>
    <div class="section" id="å–˜æ¯æœå‹™">
      <div class="section-title">å–˜æ¯æœå‹™</div>
    </div>
    <div class="section" id="è¼”å…·ç”³è«‹">
      <div class="section-title">è¼”å…·ç”³è«‹</div>
    </div>
    <div class="section" id="å…¶å®ƒ">
      <div class="section-title">å…¶å®ƒ</div>
    </div>

  </div>

  <div class="fab" onclick="toggleMenu()">ï¼‹</div>
<div class="menu" id="menu">
  <button onclick="openModal()">æ–°å¢ä»»å‹™</button>
  <button onclick="openCategoryModal()">æ–°å¢åˆ†é¡</button>
  <button onclick="enterEditMode()">ç·¨è¼¯åˆ†é¡</button>
</div>

<!-- âœ… æ–°å¢çš„æŒ‰éˆ•ï¼Œè®“ä½¿ç”¨è€…å®Œæˆç·¨è¼¯åˆ†é¡ -->
<button id="exitEditBtn" style="
  display: none;
  position: fixed;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  background: #00aaff;
  color: white;
  border: none;
  border-radius: 12px;
  padding: 10px 20px;
  font-size: 15px;
  font-weight: bold;
  cursor: pointer;
  z-index: 10;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
">
  âœ” å®Œæˆç·¨è¼¯
</button>


  <!-- æ–°å¢ä»»å‹™è¦–çª— -->
  <div class="modal" id="taskModal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal('taskModal')">âœ•</button>
      <h3>æ–°å¢ä»»å‹™</h3>
    <label>ä»»å‹™åˆ†é¡</label>
    <div class="inline-row">
      <!-- é€™è£¡è¦ç”¨ taskSectionï¼ˆä¸æ˜¯ detailSectionï¼‰-->
      <select id="taskSection" class="half">
      </select>

      <!-- é€™è£¡è¦ç”¨ taskImportantï¼ˆä¸æ˜¯ detailImportantï¼‰-->
      <label class="important-flag">
        <input type="checkbox" id="taskImportant">
        é‡è¦
      </label>
    </div>

      <label>ä»»å‹™æ¨™é¡Œ(å¿…å¡«)</label>
      <input type="text" id="taskTitle">
      <label>ä»»å‹™å…§å®¹</label>
      <textarea id="taskContent"></textarea>
      <label>é å®šå®Œæˆæ—¥</label>
      <input type="date" id="taskDate">
      <label>è™•ç†æƒ…å½¢</label>
      <textarea id="taskNote"></textarea>
      <button onclick="addTask()">æ–°å¢</button>
    </div>
  </div>

  <!-- ä»»å‹™å…§å®¹æª¢è¦–è¦–çª— -->
  <div class="modal" id="detailModal">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal('detailModal')">âœ•</button>
      <h3>ä»»å‹™å…§å®¹</h3>
<label>ä»»å‹™åˆ†é¡</label>
<div class="inline-row">
  <select id="detailSection" class="half">
  </select>

  <label class="important-flag">
    <input type="checkbox" id="detailImportant">
    é‡è¦
  </label>
</div>

      <label>ä»»å‹™æ¨™é¡Œ</label>
      <input type="text" id="detailTitle">
      <label>ä»»å‹™å…§å®¹</label>
      <textarea id="detailContent"></textarea>
      <label>é å®šå®Œæˆæ—¥</label>
      <input type="date" id="detailDate">
      <label>è™•ç†æƒ…å½¢</label>
      <textarea id="detailNote"></textarea>
<div style="display: flex; gap: 0.5rem;">
  <button class="save-btn-half" onclick="saveTask()">ğŸ’¾ å„²å­˜</button>
  <button class="delete-btn-half" onclick="confirmDelete()">ğŸ—‘ï¸ ç§»é™¤</button>
</div>
<button onclick="completeTask()">å·²å®Œæˆ</button>

    </div>
  </div>

  <script>
  // âœ… åˆ†é¡åœ¨é€™è£¡ç¶­è­·ï¼ˆæœ‰é †åºï¼‰
let categories = [];

// âœ… é‡æ–°ç•«å‡ºæ‰€æœ‰åˆ†é¡å€å¡Šï¼ˆä¾ç…§ categories é †åºï¼‰
function renderSections(list){
  const wrap = document.getElementById('section-container');
  wrap.innerHTML = ''; // æ¸…ç©º

  list.forEach(name => {
    const sec = document.createElement('div');
    sec.className = 'section';
    sec.id = name;
    sec.innerHTML = `<div class="section-title">${name}</div>`;
    wrap.appendChild(sec);
  });

  updateSectionOptions();   // é‡å»ºå…©å€‹ä¸‹æ‹‰
  // é‡æ–°æ›ä¸Šæ‹–æ‹‰ï¼ˆå› ç‚ºå‰›å‰›é‡å»ºäº† DOMï¼‰
  initSectionSortable();
}

// âœ… åªå­˜åˆ†é¡ï¼ˆä¸è¦å†å¾ tasks æ¨å›å»ï¼‰
function saveCategoriesToFirebase(){
  if(!roomPath) return;
  db.ref(`${roomPath}/categories`).set(categories);
}
// === Firebase åˆå§‹åŒ–ï¼ˆæ”¾åœ¨é€™æ”¯ <script> çš„æœ€ä¸Šé¢ï¼‰===
const firebaseConfig = {
  apiKey: "AIzaSyBs9sWJ2WHIuTmU0Jw7U_120uMManBES1E",
  authDomain: "kjreminder-24d74.firebaseapp.com",
  projectId: "kjreminder-24d74",
  storageBucket: "kjreminder-24d74.firebasestorage.app",
  messagingSenderId: "176371952161",
  appId: "1:176371952161:web:948121be209cd2e4181160",
  databaseURL: "https://kjreminder-24d74-default-rtdb.asia-southeast1.firebasedatabase.app/"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let roomPath = ""; // â† æ”¾é€™è£¡ï¼å…¨æª”åªå‡ºç¾ä¸€æ¬¡
let tasksRef = null;
let completedRef = null; // ä¹‹å¾Œä½ æœ‰åš completedTasks å³å¯ç”¨åˆ°

const DEFAULT_CATEGORIES = ['ç…§é¡§æœå‹™','å°ˆæ¥­æœå‹™','äº¤é€šæ¥é€','å–˜æ¯æœå‹™','è¼”å…·ç”³è«‹','å…¶å®ƒ'];

// å°å·¥å…·ï¼šæŠŠä¸åˆæ³•å­—å…ƒæ›æ‰ï¼ˆFirebase è·¯å¾‘ä¸èƒ½æœ‰ . # $ [ ] /ï¼‰
function sanitizeKey(s){
  return String(s).replace(/[.#$/\[\]\/]/g, '_');
}


// 1) å…¨åŸŸç‹€æ…‹ï¼ˆæ”¾åœ¨ä½ çš„å…¨åŸŸè®Šæ•¸å€ï¼‰
let dayMode = 'work'; // 'work' å·¥ä½œå¤©(é è¨­) / 'calendar' æ—¥æ›†å¤©
    let tasks = [];
    let selectedTaskId = null;

function hydrateRoomPath(){
  // å¾ localStorage è£¡æŠŠæˆ¿é–“è³‡è¨Šé‚„åŸå› roomPathï¼ˆå¦‚æœæœ‰ï¼‰
  try {
    const saved = localStorage.getItem('todo_room_info');
    if (!saved) return;
    const { username, password } = JSON.parse(saved);
    roomPath = `rooms/${sanitizeKey(username)}-${sanitizeKey(password)}`;
  } catch (e) {
    console.warn('hydrateRoomPath å¤±æ•—ï¼š', e);
  }
}

    function toggleMenu() {
      const menu = document.getElementById('menu');
      menu.style.display = (menu.style.display === 'flex') ? 'none' : 'flex';
    }
function openModal() {
  updateSectionOptions();                 // â˜… æ¯æ¬¡æ‰“é–‹å…ˆåŒæ­¥
  document.getElementById('taskModal').style.display = 'flex';
  document.getElementById('menu').style.display = 'none';
}


    function closeModal(id) {
      document.getElementById(id).style.display = 'none';
    }

//å‰©é¤˜å¤©æ•¸é‚è¼¯
// 2) å–ä»£ä½ ç›®å‰çš„ getRemainingDaysï¼ˆæ”¯æ´å…©ç¨®æ¨¡å¼ï¼‰
function getRemainingDays(dateStr) {
  if (!dateStr) return null;
  const today = new Date(); today.setHours(0,0,0,0);
  const target = new Date(dateStr); target.setHours(0,0,0,0);

  if (dayMode === 'calendar') {
    // æ—¥æ›†å¤©ï¼šå«å…­æ—¥ï¼›ä»Šå¤©=0ã€æ˜å¤©=+1ã€æ˜¨å¤©=-1
    const ms = target.getTime() - today.getTime();
    return Math.round(ms / 86400000);
  }

  // å·¥ä½œå¤©ï¼šæ’é™¤å…­æ—¥ï¼›ä»Šå¤©=0ï¼›æœªä¾†/éå»éƒ½ä»¥å·¥ä½œå¤©è¨ˆ
  if (target.getTime() === today.getTime()) return 0;
  const forward = target > today;
  let start = new Date(forward ? today : target);
  let end   = new Date(forward ? target : today);

  let count = 0, cur = new Date(start);
  while (cur <= end) {
    const d = cur.getDay();
    if (d !== 0 && d !== 6) count++;     // åªç®—é€±ä¸€ï½é€±äº”
    cur.setDate(cur.getDate() + 1);
  }
  count = count - 1;                      // ä¸å«èµ·å§‹æ—¥
  return forward ? count : -count;
}



    function getColorByDays(days) {
      if (days == null) return 'var(--green-light)';
      if (days >= 7) return 'var(--green-light)';
      if (days >= 4) return '#ffeaea';
      if (days >= 1) return '#ffb3b3';
      return '#ff8080';
    }

    function addTask() {
  const section = document.getElementById('taskSection').value;
  const title   = document.getElementById('taskTitle').value;
  const content = document.getElementById('taskContent').value;
  const date    = document.getElementById('taskDate').value;
  const note    = document.getElementById('taskNote').value;

  if (!title) return;

  // è®€ã€Œé‡è¦ã€å‹¾é¸ï¼ˆæ²’æœ‰é€™å€‹æ¬„ä½å°±å…ˆè¨­ falseï¼‰
  const importantEl = document.getElementById('taskImportant');
  const important   = importantEl ? importantEl.checked : false;

  const id = `task-${Date.now()}`;
  const task = { id, section, title, content, date, note, important };
  tasks.push(task);

  const days = getRemainingDays(date);
  const bg = getColorByDays(days);
  const displayDays = (days == null) ? 'ç„¡' : days;

  const el = document.createElement('div');
  el.className = 'task';
  el.dataset.id = id;
  el.style.backgroundColor = bg;
  el.innerHTML = `
    <div class="task-content">
      <div class="task-title">${getTitleWithFlag(task)}</div>
    </div>
    <div class="task-days">${displayDays}</div>
  `;
  el.onclick = () => openDetail(id);

  document.getElementById(section).appendChild(el);
  sortTasks(section);

// é—œé–‰è¦–çª—ï¼ˆåŠ å›é€™è¡Œï¼‰
closeModal('taskModal');

  // æ¸…ç©ºè¡¨å–®
  document.getElementById('taskTitle').value = '';
  document.getElementById('taskContent').value = '';
  document.getElementById('taskDate').value = '';
  document.getElementById('taskNote').value = '';
  if (importantEl) importantEl.checked = false;   // â† æŠŠã€Œé‡è¦ã€å‹¾é¸æ¸…æ‰

  applyDayFilter();
  saveTasksToFirebase();
}


//æ’åºé‚è¼¯ç”¨
function sortTasks(section) {
  const container = document.getElementById(section);
  const tasksInSection = Array.from(container.querySelectorAll('.task'));

  tasksInSection.sort((a, b) => {
    const taskA = tasks.find(t => t.id === a.dataset.id);
    const taskB = tasks.find(t => t.id === b.dataset.id);

    const daysA = getRemainingDays(taskA.date);
    const daysB = getRemainingDays(taskB.date);

    // ç©ºæ—¥æœŸè¦–ç‚ºæœ€å¤§å¤©æ•¸ï¼ˆæ’åºåˆ°æœ€ä¸‹é¢ï¼‰
    const safeDaysA = daysA == null ? Infinity : daysA;
    const safeDaysB = daysB == null ? Infinity : daysB;

    return safeDaysA - safeDaysB;
  });

  // æ¸…ç©ºå¾Œä¾æ’åºçµæœé‡æ–°åŠ å…¥
  tasksInSection.forEach(taskEl => container.appendChild(taskEl));
}


    function openDetail(id) {
      selectedTaskId = id;
      const task = tasks.find(t => t.id === id);
      if (!task) return;

      document.getElementById('detailSection').value = task.section;
      document.getElementById('detailTitle').value = task.title;
      document.getElementById('detailContent').value = task.content;
      document.getElementById('detailDate').value = task.date;
      document.getElementById('detailNote').value = task.note;

      document.getElementById('detailModal').style.display = 'flex';
setDetailReadonly(false);   // åŠ åœ¨ openDetail() å¡«å€¼å¾Œ
document.getElementById('detailImportant').checked = !!task.important;


    }


//å„²å­˜åŠŸèƒ½
function saveTask() {
  if (!selectedTaskId) return;

  const task = tasks.find(t => t.id === selectedTaskId);
  if (!task) return;

  task.section = document.getElementById('detailSection').value;
  task.title = document.getElementById('detailTitle').value;
  task.content = document.getElementById('detailContent').value;
  task.date = document.getElementById('detailDate').value;
  task.note = document.getElementById('detailNote').value;
task.important = document.getElementById('detailImportant').checked;   // â˜…æ–°å¢

  const oldEl = document.querySelector(`[data-id='${task.id}']`);
  if (oldEl) oldEl.remove();

  const days = getRemainingDays(task.date);
  const bg = getColorByDays(days);
  const displayDays = (days == null) ? 'ç„¡' : days;

  const el = document.createElement('div');
  el.className = 'task';
  el.dataset.id = task.id;
  el.style.backgroundColor = bg;
el.innerHTML = `
  <div class="task-content">
    <div class="task-title">${getTitleWithFlag(task)}</div>
  </div>
  <div class="task-days">${displayDays}</div>
`;

  el.onclick = () => openDetail(task.id);

  document.getElementById(task.section).appendChild(el);
  sortTasks(task.section);

  closeModal('detailModal'); // âœ… æ–°å¢é€™ä¸€è¡Œ
applyDayFilter();
saveTasksToFirebase();


}

//ç§»é™¤åŠŸèƒ½
function confirmDelete() {
  document.getElementById('confirmModal').style.display = 'flex';
}

function deleteTask() {
  if (!selectedTaskId) return;

  const el = document.querySelector(`[data-id='${selectedTaskId}']`);
  if (el) el.remove();

  tasks = tasks.filter(t => t.id !== selectedTaskId);

  closeModal('confirmModal');
  closeModal('detailModal');
saveTasksToFirebase();  // â† åŠ é€™è¡Œ

}
//æ–°å¢åˆ†é¡åŠŸèƒ½
function openCategoryModal() {
  document.getElementById('newCategoryName').value = '';
  document.getElementById('categoryModal').style.display = 'flex';
  document.getElementById('menu').style.display = 'none'; // âœ… è‡ªå‹•é—œé–‰é¸å–®
}

function addCategory() {
  const name = document.getElementById('newCategoryName').value.trim();
  if (!name) return;
  if (categories.includes(name)) { alert("æ­¤åˆ†é¡å·²å­˜åœ¨ï¼"); return; }

  // âœ… æ›´æ–°é™£åˆ—ã€å­˜é›²ã€é‡ç•«
  categories.push(name);
  saveCategoriesToFirebase();
  renderSections(categories);

  closeModal('categoryModal');
}



//é˜²é›™æ“Š
  let lastTouchTime = 0;
  document.addEventListener('touchend', function (event) {
    const now = new Date().getTime();
    if (now - lastTouchTime <= 300) {
      event.preventDefault(); // é˜»æ­¢ç¬¬äºŒæ¬¡é»æ“Šå°è‡´æ”¾å¤§
    }
    lastTouchTime = now;
  }, false);


//ç·¨è¼¯åˆ†é¡åŠŸèƒ½

let pendingRenameId = null;

function enterEditMode() {
  const sections = document.querySelectorAll('.section');
  sections.forEach(section => {
    section.classList.add('edit-mode');
    section.setAttribute('draggable', 'true');

    const titleBar = section.querySelector('.section-title');
    const currentName = section.id;

    // ç›´æ¥é‡ç¹ª titleBarï¼Œç¢ºä¿æœ‰çµæ§‹åŒ–ç¯€é»å¯æ“ä½œ
    titleBar.innerHTML = '';
    // æ‹–æ‹‰æŠŠæ‰‹
    const drag = document.createElement('span');
    drag.className = 'drag-handle';
    drag.innerHTML = 'â˜°';
    titleBar.appendChild(drag);

    // åç¨±å®¹å™¨
    const nameSpan = document.createElement('span');
    nameSpan.className = 'section-name';
    nameSpan.style.marginLeft = '0.5rem';
    nameSpan.textContent = currentName;
    titleBar.appendChild(nameSpan);

    // é‡å‘½åæŒ‰éˆ•ï¼ˆâœï¼‰
    const renameBtn = document.createElement('button');
    renameBtn.className = 'rename-btn';
    renameBtn.innerHTML = 'âœ';
    renameBtn.onclick = () => openRenameModal(section.id);
    titleBar.appendChild(renameBtn);

    // åˆªé™¤æŒ‰éˆ•ï¼ˆâœ•ï¼‰
    const delBtn = document.createElement('button');
    delBtn.className = 'delete-btn';
    delBtn.innerHTML = 'âœ•';
    delBtn.onclick = () => confirmDeleteCategory(section.id);
    titleBar.appendChild(delBtn);
  });

  document.getElementById('exitEditBtn').style.display = 'block';
  document.getElementById('menu').style.display = 'none';
}

// åˆªé™¤åˆ†é¡å½ˆçª—
function confirmDeleteCategory(id) {
  const category = document.getElementById(id);
  if (!category) return;

  // å»ºç«‹ç¢ºèªè¦–çª—
  const confirmBox = document.createElement('div');
  confirmBox.className = 'modal';
  confirmBox.style.display = 'flex';
  confirmBox.innerHTML = `
    <div class="modal-content">
      <h3 style="text-align: center;">æ˜¯å¦ç¢ºèªåˆªé™¤æ­¤åˆ†é¡ï¼Ÿ</h3>
      <div class="confirm-buttons">
        <button class="confirm-btn">ç¢ºèª</button>
        <button class="cancel-btn">å–æ¶ˆ</button>
      </div>
    </div>
  `;

  // ç¶å®šæŒ‰éˆ•äº‹ä»¶
confirmBox.querySelector('.confirm-btn').onclick = () => {
  // âœ… å…ˆè™•ç†ä»»å‹™ï¼šæŠŠåœ¨é€™å€‹åˆ†é¡çš„ä»»å‹™ï¼Œç§»å»ä¸€å€‹å®‰å…¨åˆ†é¡
  const fallback = categories.find(c => c !== id) || 'å…¶å®ƒ';
  tasks.forEach(t => { if (t.section === id) t.section = fallback; });
  completedTasks.forEach(t => { if (t.section === id) t.section = fallback; });
  saveTasksToFirebase(); // ä»»å‹™æœ‰å‹•åˆ°å°±å­˜ä¸€ä¸‹

  // âœ… æ›´æ–°åˆ†é¡é™£åˆ—
  categories = categories.filter(c => c !== id);
  saveCategoriesToFirebase();

  // âœ… é‡ç•«åˆ†é¡èˆ‡ä»»å‹™
  renderSections(categories);
  if (statusFilter === 'done') renderCompletedTasks(); else showOngoing();

  confirmBox.remove();
};
  confirmBox.querySelector('.cancel-btn').onclick = () => {
    confirmBox.remove();
  };

  document.body.appendChild(confirmBox);

// âœ… åŒæ­¥å¾æ‰€æœ‰ select ä¸­ç§»é™¤é€™å€‹åˆ†é¡é¸é …
const selects = [document.getElementById('taskSection'), document.getElementById('detailSection')];
selects.forEach(select => {
  const option = select.querySelector(`option[value="${id}"]`);
  if (option) option.remove();
});
}




//ç¢ºèªå®Œæˆç·¨è¼¯
function exitEditMode() {
  const sections = document.querySelectorAll('.section');
  sections.forEach(section => {
    section.classList.remove('edit-mode');
    section.removeAttribute('draggable');
    section.ondragstart = null;
    section.ondragover = null;
    section.ondrop = null;

    // é¸æ“‡ .drag-handle å’Œ .delete-btnï¼Œä¸¦ç§»é™¤
    const titleBar = section.querySelector('.section-title');
    if (titleBar) {
      const drag = titleBar.querySelector('.drag-handle');
      const del = titleBar.querySelector('.delete-btn');
      if (drag) drag.remove();
      if (del) del.remove();
    }
  });

  // éš±è—ã€Œå®Œæˆç·¨è¼¯ã€æŒ‰éˆ•
  document.getElementById('exitEditBtn').style.display = 'none';
}
document.getElementById('exitEditBtn').onclick = exitEditMode;

//æ‰‹æ©Ÿæ‹–æ‹‰
function initSectionSortable(){
  const el = document.getElementById('section-container');
  if (!el) return;

  new Sortable(el, {
    animation: 150,
    handle: '.drag-handle',
    draggable: '.section',     // åªè®“ .section å¯æ‹–ï¼Œä¸æ‹–åˆ° #doneMore
    ghostClass: 'dragging',

    // â­ æ‰‹æ©Ÿé‡é»åœ¨é€™è£¡
    forceFallback: true,       // iOS å¿…å‚™ï¼šæ”¹ç”¨æ¨¡æ“¬æ‹–æ›³
    fallbackOnBody: true,
    delayOnTouchOnly: true,    // åªåœ¨è§¸æ§è£ç½®åŠ å»¶é²
    delay: 120,                // é•·æŒ‰ 120ms å†é–‹å§‹æ‹–
    touchStartThreshold: 5,    // æ‰‹æŒ‡ç§»å‹• 5px æ‰ç®—é–‹å§‹æ‹–

    onEnd: () => {
      categories = Array.from(document.querySelectorAll('#section-container .section'))
        .map(sec => sec.id);
      saveCategoriesToFirebase();
    }
  });
}

function openRenameModal(sectionId) {
  pendingRenameId = sectionId;
  document.getElementById('renameInput').value = sectionId;
  document.getElementById('renameModal').style.display = 'flex';
}

function confirmRename() {
  const oldId = pendingRenameId;
  const newName = document.getElementById('renameInput').value.trim();
  if (!newName || document.getElementById(newName)) {
    alert('åç¨±ä¸å¯ç‚ºç©ºæˆ–å·²å­˜åœ¨ï¼');
    return;
  }

  // é€²è¡Œä¸­ä»»å‹™ï¼šæ”¹ section
  tasks.forEach(t => { if (t.section === oldId) t.section = newName; });

  // å·²å®Œæˆä»»å‹™ï¼šä¹Ÿè¦æ”¹ section
  completedTasks.forEach(t => { if (t.section === oldId) t.section = newName; });

  // âœ… æŠŠ categories é™£åˆ—è£¡çš„èˆŠåæ›æ–°å
  categories = categories.map(c => c === oldId ? newName : c);
  saveCategoriesToFirebase();   // å­˜åˆ†é¡
  saveTasksToFirebase();        // å­˜ä»»å‹™

  // âœ… é‡ç•« + ä¾ç•¶å‰é ç±¤åˆ·æ–°
  renderSections(categories);
  if (statusFilter === 'done') {
    renderCompletedTasks();
  } else {
    showOngoing();
  }

  closeModal('renameModal');
  pendingRenameId = null;
}




//æ–°å¢åˆ†é¡
function updateSectionOptions() {
  const sections = document.querySelectorAll('.section');
  const options = Array.from(sections).map(section => {
    const id = section.id;
    return `<option value="${id}">${id}</option>`;
  }).join('');

  document.getElementById('taskSection').innerHTML = options;
  document.getElementById('detailSection').innerHTML = options;
}

//æ›´å¤šåŠŸèƒ½-ç¯©é¸å‰©é¤˜æ—¥
let filterDay = "all"; // é è¨­å…¨éƒ¨

document.addEventListener("change", function(e) {
  if (e.target.matches('.filter-days input[type="radio"]')) {
    filterDay = e.target.value;   // ç›´æ¥åˆ‡æ›
    applyDayFilter();
  }
});

function applyDayFilter() {
  document.querySelectorAll(".task").forEach(taskEl => {
    const task = tasks.find(t => t.id === taskEl.dataset.id);
    if (!task) return;

    const days = getRemainingDays(task.date);
    let show = true;

    if (filterDay !== "all") {
      const v = parseInt(filterDay, 10);   // 0/1/2/3
      // ç„¡æ—¥æœŸ -> ä¸é¡¯ç¤ºï¼›é¸ 0 è¡¨ç¤º <=0ï¼ˆå«è² æ•¸ï¼‰ï¼Œå…¶é¤˜ N è¡¨ç¤º <=N
      show = (days !== null) && (days <= v);
    }

    taskEl.style.display = show ? "" : "none";
  });
}



function openModalById(id) {
  document.getElementById(id).style.display = 'flex';
}

//æ­·å²ç´€éŒ„
// ====== æ–°å¢çš„å…¨åŸŸç‹€æ…‹ ======
let completedTasks = [];          // æ­¸æª”çš„å®Œæˆä»»å‹™
let statusFilter = "ongoing";     // é€²è¡Œä¸­ / å·²å®Œæˆ
let completedMonthFilter = "recent15"; // recent15 æˆ– '11407' é€™ç¨®æœˆä»½

// å–®é¸ï¼šä»»å‹™ç‹€æ…‹ï¼ˆå³æ™‚åˆ‡æ›ï¼‰
document.addEventListener("change", function(e){
  if (e.target.matches('.filter-status input[type="radio"]')) {
    statusFilter = e.target.value;              // 'ongoing' or 'done'
    if (statusFilter === 'done') {
      completedMonthFilter = "recent15";
      buildDoneMonthMenu();                    // ç”Ÿæˆæœˆä»½æ¸…å–®
      document.getElementById('doneMore').style.display = 'block';
      renderCompletedTasks();
    } else {
      document.getElementById('doneMore').style.display = 'none';
      showOngoing();                           // å›åˆ°é€²è¡Œä¸­
    }
  }
});
// 3) ç›£è½ã€Œå¤©æ•¸è¨­å®šã€åˆ‡æ›ï¼ˆåœ¨ä½ çš„ document.addEventListener å€å¡ŠåŠ é€™æ®µï¼‰
document.addEventListener("change", function(e){
  if (e.target.matches('.filter-mode input[type="radio"]')) {
    dayMode = e.target.value;                 // 'work' or 'calendar'
    if (statusFilter === 'done') {
      renderCompletedTasks();                 // å®Œæˆè¦–åœ–ä¸åƒå¤©æ•¸ï¼Œä½†ä¿æŒä¸€è‡´åˆ·æ–°
    } else {
      showOngoing();                          // é‡æ–°è¨ˆç®—å¤©æ•¸/é¡è‰²/æ’åºä¸¦å¥—ç”¨ç¯©é¸
    }
  }
});


// å®ŒæˆæŒ‰éˆ•ï¼šæ”¹ç‚ºæ­¸æª”ï¼ˆè¦†è“‹ä½ çš„ completeTaskï¼‰
function completeTask() {
  if (!selectedTaskId) return;

  const idx = tasks.findIndex(t => t.id === selectedTaskId);
  if (idx === -1) return;

  // ç”¨ timestampï¼ˆnumberï¼‰å­˜åˆ°é›²ç«¯æœ€ç©©
  const finished = { ...tasks[idx], completedAt: Date.now() };

  tasks.splice(idx, 1);
  const el = document.querySelector(`[data-id='${selectedTaskId}']`);
  if (el) el.remove();
  closeModal('detailModal');

  completedTasks.push(finished);

  // å„²å­˜å·²å®Œæˆä»»å‹™åˆ° Firebase
  saveTasksToFirebase();

  // å‹•ç•«
  const checkmark = document.getElementById('check-success');
  checkmark.classList.add('show');
  setTimeout(() => checkmark.classList.remove('show'), 1500);

  if (statusFilter === 'done') {
    buildDoneMonthMenu();
    renderCompletedTasks();
  }
}


// ====== æ¸²æŸ“é‚è¼¯ ======
function clearAllSections() {
  document.querySelectorAll('.section').forEach(sec => {
    // ä¿ç•™ section-titleï¼Œæ¸…æ‰ä»»å‹™å¡
    Array.from(sec.querySelectorAll('.task')).forEach(t => t.remove());
  });
}

function showOngoing() {
  clearAllSections();
// æŠŠä»»å‹™è£¡ç”¨åˆ°çš„åˆ†é¡è£œé€² categoriesï¼ˆé¿å…æœ‰ä»»å‹™ä½†æ²’æœ‰åˆ†é¡ï¼‰
const needed = Array.from(new Set(tasks.map(t => t.section).filter(Boolean)));
const union = Array.from(new Set([...(categories || []), ...needed]));
if (union.length !== (categories || []).length) {
  categories = union;
  saveCategoriesToFirebase();
  renderSections(categories); // å…ˆæŠŠåˆ†é¡ç•«å¥½ï¼Œä¸‹é¢æ‰æ¸²æŸ“ä»»å‹™
}
  // é‡æ–°æŠŠé€²è¡Œä¸­ tasks ä¾ section æ¸²æŸ“
  tasks.forEach(t => {
    const days = getRemainingDays(t.date);
    const bg = getColorByDays(days);
    const displayDays = (days == null) ? 'ç„¡' : days;

    const el = document.createElement('div');
    el.className = 'task';
    el.dataset.id = t.id;
    el.style.backgroundColor = bg;
    el.innerHTML = `
      <div class="task-content">
        <div class="task-title">${getTitleWithFlag(t)}</div>
      </div>
      <div class="task-days">${displayDays}</div>
    `;
    el.onclick = () => openDetail(t.id);
    const sec = document.getElementById(t.section);
    if (sec) sec.appendChild(el);
  });

  // ä¾ä½ åŸæœ¬é‚è¼¯æ’åº
  const sections = new Set(tasks.map(t => t.section));
  sections.forEach(sortTasks);

  // é€²è¡Œä¸­ä¹Ÿè¦å¥—ç”¨ä½ ç›®å‰çš„ã€Œå‰©é¤˜å¤©æ•¸ã€ç¯©é¸
  applyDayFilter();
}

// è½‰æ°‘åœ‹å¹´æœˆï¼ˆå›å‚³å¦‚ "11407"ï¼‰
// ç¢ºä¿å®Œæ•´åœ°è™•ç†æ™‚é–“æˆ³
function toRocYM(d) {
  const yy = d.getFullYear() - 1911; // è¨ˆç®— ROC å¹´ï¼ˆæ¸›å» 1911ï¼‰
  const mm = (d.getMonth() + 1).toString().padStart(2, '0'); // ç¢ºä¿æœˆä»½ç‚º 2 ä½æ•¸
  const result = `${yy}${mm}`;
  console.log('toRocYM result:', result); // èª¿è©¦ï¼Œç¢ºèªè½‰æ›æ˜¯å¦æ­£ç¢º
  return result;
}

// ç”Ÿæˆæœˆä»½æ¸…å–®ï¼ˆåƒ…åˆ—å‡º >15 å¤©çš„æœˆä»½ï¼Œä¸”æœ‰è³‡æ–™çš„ï¼‰
function buildDoneMonthMenu() {
  const menu = document.getElementById('doneMonthMenu');
  if (!menu) return;
  menu.innerHTML = '';

  // ç½®é ‚ï¼šè¿‘5æ—¥
  const recentBtn = document.createElement('button');
  recentBtn.textContent = 'è¿‘5æ—¥';
  recentBtn.style.cssText = 'display:block;border:0;background:#fff;padding:6px 10px;border-radius:6px;cursor:pointer;width:100%;text-align:left;font-weight:600;';
  recentBtn.onclick = () => {
    completedMonthFilter = 'recent15';
    menu.style.display = 'none';
    renderCompletedTasks();
  };
  menu.appendChild(recentBtn);

  const monthSet = new Set();
  
  completedTasks.forEach(t => {
    const d = new Date(t.date);  // â† æ”¹ç”¨é å®šå®Œæˆæ—¥æœŸ
    const rocYM = toRocYM(d);
    console.log('Adding month:', rocYM);  // èª¿è©¦ï¼Œæª¢æŸ¥æ¯å€‹ä»»å‹™çš„å¹´æœˆæ˜¯å¦æ­£ç¢º
    monthSet.add(rocYM);
  });

  if (monthSet.size === 0) {
    const empty = document.createElement('div');
    empty.textContent = 'ç„¡æ›´å¤šæœˆä»½';
    menu.appendChild(empty);
    return;
  }

  // å°‡æœˆä»½æŒ‰å­—æ¯æ’åºä¸¦ç”ŸæˆæŒ‰éˆ•
  Array.from(monthSet).sort((a, b) => b.localeCompare(a)).forEach(ym => {
    const btn = document.createElement('button');
    btn.textContent = ym;
    btn.style.cssText = 'display:block;border:0;background:#fff;padding:6px 10px;border-radius:6px;cursor:pointer;width:100%;text-align:left;';
    btn.onclick = () => {
      completedMonthFilter = ym;
      menu.style.display = 'none';
      renderCompletedTasks();
    };
    menu.appendChild(btn);
  });
}

// é»ã€Œæ›´å¤šâ€¦ã€å±•é–‹æœˆä»½æ¸…å–®
document.getElementById('doneMoreBtn')?.addEventListener('click', () => {
  const menu = document.getElementById('doneMonthMenu');
  if (!menu) return;
  menu.style.display = (menu.style.display === 'none' || menu.style.display === '') ? 'block' : 'none';
});

// æ¸²æŸ“å·²å®Œæˆï¼ˆé è¨­é¡¯ç¤º 15 æ—¥å…§ï¼›é»æœˆä»½å‰‡é¡¯ç¤ºè©²æœˆä»½ï¼‰
function renderCompletedTasks() {
  clearAllSections();
// æŠŠå·²å®Œæˆä»»å‹™ç”¨åˆ°çš„åˆ†é¡ä¹Ÿè£œå› categories
const needFromDone = Array.from(new Set(completedTasks.map(t => t.section).filter(Boolean)));
const union2 = Array.from(new Set([...(categories || []), ...needFromDone]));
if (union2.length !== (categories || []).length) {
  categories = union2;
  saveCategoriesToFirebase();
  renderSections(categories);
}

  const now = new Date();
  const list = completedTasks.filter(t => {
    const d = new Date(t.date);  // â† æ”¹ç”¨é å®šå®Œæˆæ—¥æœŸ
    const rocYM = toRocYM(d);  // è½‰æ›ç‚º ROC å¹´æœˆ

    console.log('Task completedAt:', t.completedAt, 'Converted to ROC YM:', rocYM); // èª¿è©¦ï¼Œç¢ºèªæ¯å€‹ä»»å‹™çš„æ™‚é–“æˆ³èˆ‡è½‰æ›çµæœ

if (completedMonthFilter === 'recent15') {
  const completedDate = new Date(t.completedAt);  // â† ç”¨å¯¦éš›å®Œæˆæ—¥æœŸ
  const diff = Math.floor((Date.now() - completedDate.getTime()) / 86400000);
  return diff <= 5;  // åªé¡¯ç¤ºæœ€è¿‘ 5 å¤©å®Œæˆçš„ä»»å‹™
} else {
  return rocYM === completedMonthFilter;  // æœˆä»½æ­¸é¡ç”¨é å®šå®Œæˆæ—¥æœŸ
}
  });

  list.forEach(t => {
    const el = document.createElement('div');
    el.className = 'task';
    el.dataset.id = t.id;
    el.style.backgroundColor = 'var(--green-light)'; // å®Œæˆç”¨æ·¡ç¶ è‰²èƒŒæ™¯
    el.innerHTML = `
      <div class="task-content">
        <div class="task-title">âœ… ${t.important ? 'â— ' : ''}${t.title}</div>
      </div>
      <div class="task-days">å®Œ</div>
    `;
    el.onclick = () => openCompletedDetail(t.id);
    const sec = document.getElementById(t.section);
    if (sec) sec.appendChild(el);
  });
}




//å·²å®Œæˆè¦–çª—ç´°ç¯€
function setDetailReadonly(ro) {
  ['detailSection','detailTitle','detailContent','detailDate','detailNote']
    .forEach(id => { const el = document.getElementById(id); if (el) el.disabled = ro; });

  const saveBtn = document.querySelector('#detailModal .save-btn-half');
  const delBtn  = document.querySelector('#detailModal .delete-btn-half');
  const completeBtn = Array.from(document.querySelectorAll('#detailModal button'))
    .find(b => b.textContent.includes('å·²å®Œæˆ'));


  if (ro) {
    if (saveBtn) { saveBtn.textContent = 'æˆ‘äº†è§£äº†ï¼'; saveBtn.onclick = () => closeModal('detailModal'); }
    if (delBtn)  { delBtn.onclick = confirmDeleteCompleted; } // â† æ”¹å«ã€Œç¢ºèªåˆªé™¤(å®Œæˆ)ã€

    if (completeBtn) completeBtn.style.display = 'none';
  } else {
    if (saveBtn) { saveBtn.textContent = 'ğŸ’¾ å„²å­˜'; saveBtn.onclick = saveTask; }
    if (delBtn)  { delBtn.onclick = confirmDelete; }
    if (completeBtn) completeBtn.style.display = '';
  }

  // â˜… æ–°å¢ï¼šé–ä½/è§£é–ã€Œé‡è¦ã€checkbox
  const importantEl = document.getElementById('detailImportant');
  if (importantEl) importantEl.disabled = ro;

}

let selectedCompletedId = null;
function openCompletedDetail(id) {
  selectedCompletedId = id;
  const t = completedTasks.find(x => x.id === id);
  if (!t) return;

  // å¡«å€¼
  document.getElementById('detailSection').value = t.section;
  document.getElementById('detailTitle').value   = t.title;
  document.getElementById('detailContent').value = t.content || '';
  document.getElementById('detailDate').value    = t.date || '';
  document.getElementById('detailNote').value    = t.note || '';

  setDetailReadonly(true);
  document.getElementById('detailModal').style.display = 'flex';
}

function deleteCompleted() {
  if (!selectedCompletedId) return;
  const idx = completedTasks.findIndex(x => x.id === selectedCompletedId);
  if (idx >= 0) completedTasks.splice(idx, 1);
  closeModal('detailModal');
  renderCompletedTasks();
}

function confirmDeleteCompleted() {
  const modal = document.getElementById('confirmModal');
  const confirmBtn = modal.querySelector('.confirm-btn');

  const oldHandler = confirmBtn.onclick;     // æš«å­˜åŸæœ¬ï¼ˆé€²è¡Œä¸­åˆªé™¤ï¼‰çš„ handler
  confirmBtn.onclick = () => {                // æš«æ™‚æ”¹æˆåˆªã€Œå·²å®Œæˆã€
    deleteCompletedConfirmed();
    confirmBtn.onclick = oldHandler;          // åˆªå®Œé‚„åŸ
  };

  modal.style.display = 'flex';
}

function deleteCompletedConfirmed() {
  if (!selectedCompletedId) return;
  const idx = completedTasks.findIndex(x => x.id === selectedCompletedId);
  if (idx >= 0) completedTasks.splice(idx, 1);

  // âœ… é€™è¡Œä¸€å®šè¦
  saveTasksToFirebase();

  closeModal('confirmModal');
  closeModal('detailModal');
  renderCompletedTasks();
}
//ç™»å…¥

let loggingIn = false;

function setLoginBusy(busy){
  const btn = document.getElementById('login-btn');
  if (!btn) return;
  btn.disabled = busy;
  btn.textContent = busy ? 'ç™»å…¥ä¸­â€¦' : 'ç™»å…¥';
}

auth.onAuthStateChanged(user => {
  try {
    hydrateRoomPath();
    if (user) {
      // åªæœ‰ç¢ºå¯¦æœ‰ roomPath æ‰é€²å…¥ä¸»é é¢
      if (roomPath) {
        document.getElementById('loginPage').style.display = 'none';
        document.querySelector('.container').style.display = 'block';
        loadTasksFromFirebase();
        updateSectionOptions();
      } else {
        // æ²’æœ‰ roomPath å°±ç™»å‡ºä¸¦å›åˆ°ç™»å…¥é 
        auth.signOut();
        return;
      }
    } else {
      document.querySelector('.container').style.display = 'none';
      document.getElementById('loginPage').style.display = 'flex';
    }
  } catch (e) {
    console.error('onAuthStateChanged éŒ¯èª¤ï¼š', e);
    alert('ç•«é¢åˆå§‹åŒ–å¤±æ•—ï¼š' + e.message);
    // ç™¼ç”ŸéŒ¯èª¤æ™‚ä¹Ÿè¦ç™»å‡º
    auth.signOut();
  } finally {
    setLoginBusy(false);
    loggingIn = false;
  }
});

document.getElementById('login-btn').addEventListener('click', async function(){
  if (loggingIn) return; // é˜²æ­¢é‡è¤‡é»
  const username = document.getElementById('login-username').value.trim();
  const password = document.getElementById('login-password').value.trim();
  const autoLogin = document.getElementById('auto-login').checked;

  if(!username || !password){
    alert('è«‹è¼¸å…¥å¸³è™Ÿèˆ‡å¯†ç¢¼');
    return;
  }

  roomPath = `rooms/${sanitizeKey(username)}-${sanitizeKey(password)}`;
  if(autoLogin){
    localStorage.setItem('todo_room_info', JSON.stringify({username, password}));
  } else {
    localStorage.removeItem('todo_room_info');
  }

  loggingIn = true;
  setLoginBusy(true);

 try {
  // å…ˆç™»å‡ºèˆŠçš„åŒ¿åä½¿ç”¨è€…ï¼ˆåŠ åœ¨é€™è£¡ï¼ï¼‰
  if (auth.currentUser) {
    await auth.signOut();
  }
    // è¨­ä¸€å€‹ 8 ç§’çš„ä¿è­·æ™‚é–“ï¼Œé¿å…å¡æ­»
    const loginPromise = auth.signInAnonymously();
    await Promise.race([
      loginPromise,
      new Promise((_, rej)=>setTimeout(()=>rej(new Error('ç™»å…¥é€¾æ™‚ï¼Œè«‹é‡è©¦')), 8000))
    ]);
    // ä¸åœ¨é€™è£¡åˆ‡ç•«é¢ï¼Œç­‰ onAuthStateChanged è‡ªå‹•åˆ‡
  } catch (e) {
    loggingIn = false;
    setLoginBusy(false);
    alert('ç™»å…¥å¤±æ•—ï¼š' + (e && e.message ? e.message : e));
  }
});

  // å¾é›²ç«¯è¼‰è³‡æ–™
  loadTasksFromFirebase();

// === è‡ªå‹•ç™»å…¥ï¼ˆæœ‰è¨˜éŒ„æˆ¿é–“å°±ç›´æ¥é€²ï¼‰ ===
// âœ… æœ€ç°¡å–®çš„ã€Œä¸€å®šæœƒè‡ªå‹•ç™»å…¥ã€ç‰ˆæœ¬
function autoLogin(){
  const saved = localStorage.getItem('todo_room_info');
  if (!saved) {
    // æ²’æœ‰å„²å­˜è³‡æ–™ï¼Œç¢ºä¿å›åˆ°ç™»å…¥é é¢
    if (auth.currentUser) {
      auth.signOut();
    }
    return;
  }

  const {username, password} = JSON.parse(saved);
  roomPath = `rooms/${sanitizeKey(username)}-${sanitizeKey(password)}`;

  if (!auth.currentUser && !loggingIn) {
    loggingIn = true;
    setLoginBusy(true);
    auth.signInAnonymously()
      .catch(console.warn)
      .finally(() => { loggingIn = false; setLoginBusy(false); });
  }
}

// é€²åˆ°é é¢å°±è·‘ä¸€æ¬¡
document.addEventListener('DOMContentLoaded', autoLogin);

// å¾èƒŒæ™¯/åˆ¥é å›ä¾†ä¹Ÿæœƒå†è·‘ä¸€æ¬¡ï¼ˆiPhone/Safari æœ€å¸¸ç”¨é€™å€‹ï¼‰
window.addEventListener('pageshow', autoLogin);
// === å¾é›²ç«¯è¼‰å…¥ï¼ˆå…ˆåšé€²è¡Œä¸­ tasksï¼›completed ä¹‹å¾Œå†æ¥ï¼‰===
function loadTasksFromFirebase() {
  if (!roomPath || !auth.currentUser) return;

  // å…ˆå–æ¶ˆèˆŠç›£è½ï¼Œé¿å…é‡è¤‡ç¶
  if (tasksRef) tasksRef.off();
  if (completedRef) completedRef.off();

  tasksRef = db.ref(`${roomPath}/tasks`);
  completedRef = db.ref(`${roomPath}/completedTasks`);
  const categoriesRef = db.ref(`${roomPath}/categories`);

  tasksRef.on('value', (snap) => {
    const data = snap.val() || {};
    tasks = Object.values(data);
    showOngoing();
  });

  completedRef.on('value', (snap) => {
    const data = snap.val() || {};
    completedTasks = Object.values(data);
    if (statusFilter === 'done') renderCompletedTasks();
  });

  // è¼‰å…¥åˆ†é¡åç¨±
categoriesRef.on('value', (snap) => {
  const cloud = snap.val();

  if (Array.isArray(cloud) && cloud.length > 0) {
    // ç”¨é›²ç«¯çš„
    categories = cloud.slice();
  } else {
    // é›²ç«¯æ˜¯ç©ºçš„ â†’ ç”¨é è¨­æ¸…å–®è£œå›å»
    categories = DEFAULT_CATEGORIES.slice();
    saveCategoriesToFirebase(); // å­˜å›é›²ç«¯
  }

  // å…ˆç•«åˆ†é¡ï¼Œå†ç•«ä»»å‹™
  renderSections(categories);
  if (statusFilter === 'done') {
    renderCompletedTasks();
  } else {
    showOngoing();
  }
});
}


// === å¯«å›é›²ç«¯ï¼ˆå…ˆå¯« tasksï¼›completed ä¹‹å¾Œå†æ¥ï¼‰===
function saveTasksToFirebase() {
  const obj = {};
  tasks.forEach(t => obj[t.id] = t);

  const doneObj = {};
  completedTasks.forEach(t => doneObj[t.id] = t);

  // å„²å­˜ä»»å‹™è³‡æ–™
  db.ref(`${roomPath}/tasks`).set(obj);
  db.ref(`${roomPath}/completedTasks`).set(doneObj);

  // å„²å­˜åˆ†é¡è³‡æ–™
}

//ç™»å‡º

function openLogoutModal(){
  document.getElementById('logoutModal').style.display = 'flex';
}

async function doLogout(){
  // é—œé–‰ DB ç›£è½
  try {
    if (tasksRef) { tasksRef.off(); tasksRef = null; }
    if (completedRef) { completedRef.off(); completedRef = null; }
  } catch(e){ console.warn(e); }

  // æ¸…ç©ºæœ¬æ©Ÿè³‡æ–™
  tasks = [];
  completedTasks = [];
  selectedTaskId = null;
  clearAllSections();

  // æ¸…æ‰è‡ªå‹•ç™»å…¥èˆ‡æˆ¿é–“
  localStorage.removeItem('todo_room_info');
  roomPath = "";

  // å˜—è©¦ç™»å‡ºï¼ˆè‹¥æ²’é–‹ Auth ä¹Ÿæ²’é—œä¿‚ï¼‰
  try { if (firebase.auth) await auth.signOut(); } catch(e){ /* å¿½ç•¥ */ }

  // åˆ‡å›ç™»å…¥é 
  document.querySelector('.container').style.display = 'none';
  document.getElementById('loginPage').style.display = 'flex';

  closeModal('logoutModal');
  closeModal('moreModal'); // é—œæ‰ã€Œâ‹¯ã€é¸å–®
}


  //å¿«å–
const v = Date.now(); // æ¯æ¬¡åˆ·æ–°éƒ½å¸¶å…¥å”¯ä¸€å€¼ï¼Œé¿é–‹å¿«å–
document.querySelectorAll('link[rel="icon"], link[rel="manifest"]').forEach(el => {
  if (el.href) {
    el.href += (el.href.includes('?') ? '&' : '?') + 'v=' + v;
  }
});
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/service-worker.js?v=' + v)
    .then(reg => console.log('SW è¨»å†ŠæˆåŠŸ', reg.scope))
    .catch(err => console.log('SW è¨»å†Šå¤±æ•—', err));
}

function getTitleWithFlag(t){
  return (t.important ? 'â— ' : '') + (t.title || '');
}

function renderSections(list){
  const wrap = document.getElementById('section-container');
  // å…ˆé‡å»º doneMoreï¼ˆå›ºå®šåœ¨æœ€ä¸Šé¢ï¼‰
  wrap.innerHTML = `
    <div id="doneMore" style="display:none; text-align:right; margin:0.25rem 0;">
      <button id="doneMoreBtn" style="border:0; background:#eee; padding:6px 10px; border-radius:8px; cursor:pointer;">æ›´å¤šâ€¦</button>
      <div id="doneMonthMenu" style="display:none; position:absolute; right:16px; background:#fff; border:1px solid #ddd; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,.08); padding:6px; z-index:50;"></div>
    </div>
  `;

  // ä¾ categories ç•«å‡ºå„åˆ†é¡
  list.forEach(name => {
    const sec = document.createElement('div');
    sec.className = 'section';
    sec.id = name;
    sec.innerHTML = `<div class="section-title">${name}</div>`;
    wrap.appendChild(sec);
  });

  updateSectionOptions();
  initSectionSortable();      // ä½ å·²æœ‰çš„å‡½å¼

  // é‡æ–°æ›ã€Œæ›´å¤šâ€¦ã€æŒ‰éˆ•çš„äº‹ä»¶ï¼ˆå› ç‚º innerHTML æœƒæ¸…æ‰èˆŠçš„äº‹ä»¶ï¼‰
  const btn = document.getElementById('doneMoreBtn');
  if (btn) btn.onclick = () => {
    const menu = document.getElementById('doneMonthMenu');
    if (menu) menu.style.display = (menu.style.display === 'block' ? 'none' : 'block');
  };
}

  </script>

<div id="check-success">
  <svg viewBox="0 0 52 52">
    <circle class="circle" cx="26" cy="26" r="18" fill="none"/>
    <path class="check" fill="none" d="M14 27l7 7 16-16"/>
  </svg>
</div>

<div class="modal" id="confirmModal">
  <div class="modal-content">
    <h3 style="text-align: center;">æ˜¯å¦ç¢ºèªç§»é™¤æ­¤ä»»å‹™ï¼Ÿ</h3>
    <div class="confirm-buttons">
      <button class="confirm-btn" onclick="deleteTask()">ğŸ—‘ï¸ ç¢ºèª</button>
      <button class="cancel-btn" onclick="closeModal('confirmModal')">è¿”å›</button>
    </div>
  </div>
</div>

<!-- âœ… ç™»å‡ºç¢ºèª modal è¦å’Œä¸Šé¢åŒä¸€å±¤ï¼Œåƒè¬ä¸è¦æ”¾åœ¨ confirmModal è£¡ -->
<div class="modal" id="logoutModal">
  <div class="modal-content">
    <h3 style="text-align:center;">æ˜¯å¦ç¢ºèªç™»å‡ºï¼Ÿ</h3>
    <div class="confirm-buttons">
      <button class="confirm-btn" onclick="doLogout()">ç¢ºèª</button>
      <button class="cancel-btn" onclick="closeModal('logoutModal')">å–æ¶ˆ</button>
    </div>
  </div>
</div>

<div class="modal" id="categoryModal">
  <div class="modal-content">
<h3 style="text-align: center;">æ–°å¢åˆ†é¡</h3>
<input type="text" id="newCategoryName" placeholder="è«‹è¼¸å…¥åˆ†é¡åç¨±">
    <div class="confirm-buttons">
      <button class="confirm-btn" onclick="addCategory()">ç¢ºèª</button>
      <button class="cancel-btn" onclick="closeModal('categoryModal')">å–æ¶ˆ</button>
    </div>
  </div>
</div>
<!-- é‡å‘½ååˆ†é¡ Modal -->
<div class="modal" id="renameModal">
  <div class="modal-content">
    <button class="close-btn" onclick="closeModal('renameModal')">âœ•</button>
    <h3 style="text-align:center;">é‡æ–°å‘½ååˆ†é¡</h3>
    <input type="text" id="renameInput" placeholder="è«‹è¼¸å…¥æ–°çš„åˆ†é¡åç¨±" />
    <div class="confirm-buttons">
      <button class="confirm-btn" onclick="confirmRename()">ç¢ºèª</button>
      <button class="cancel-btn" onclick="closeModal('renameModal')">å–æ¶ˆ</button>
    </div>
  </div>
</div>




<!-- æ›´å¤šåŠŸèƒ½ Modal -->
<div class="modal" id="moreModal">
  <div class="modal-content">
    <button class="close-btn" onclick="closeModal('moreModal')">âœ•</button>
    <h3>ç¯©é¸å‰©é¤˜å¤©æ•¸</h3>
<div class="filter-days">
  <label><input type="radio" name="daysFilter" value="0"> 0</label>
  <label><input type="radio" name="daysFilter" value="1"> 1</label>
  <label><input type="radio" name="daysFilter" value="2"> 2</label>
  <label><input type="radio" name="daysFilter" value="3"> 3</label>
  <label><input type="radio" name="daysFilter" value="all" checked>ç„¡</label>
</div>
<h3>ä»»å‹™ç‹€æ…‹</h3>
<div class="filter-status">
  <label><input type="radio" name="statusFilter" value="ongoing" checked> é€²è¡Œä¸­</label>
  <label><input type="radio" name="statusFilter" value="done"> å·²å®Œæˆ</label>
</div>
<h3>å¤©æ•¸è¨­å®š</h3>
<div class="filter-mode">
  <label><input type="radio" name="dayMode" value="work" checked> å·¥ä½œå¤©</label>
  <label><input type="radio" name="dayMode" value="calendar"> æ—¥æ›†å¤©</label>
</div>
<hr style="margin:1rem 0;border:none;border-top:1px solid #eee;">
<button class="logout-btn" onclick="openLogoutModal()">ç™»å‡º</button>

  </div>
</div>

</body>
</html>
