<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"
    />
    <title>MyMemo</title>

    <!-- Icons / PWA å¯è‡ªè¡Œæ›¿æ› -->
    <link rel="icon" type="image/png" sizes="32x32" href="mymemo.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="mymemo.png" />

    <!-- Firebase (compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

    <!-- Sortable (åˆ†é¡æ‹–æ‹‰ç”¨) -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <style>
      :root {
        --blue-light: #ebf5fc;
        --yellow-light: #fffbe6; /* ç”¨ MyTask çš„é»ƒ */
        --white: #fff;
        --gray-text: #444;
        --app-bg: var(--blue-light);
      }
      * {
        box-sizing: border-box;
        font-family: "Segoe UI", sans-serif;
      }
      /* å…¨åŸŸè¼¸å…¥å…ƒä»¶å­—é«”å¤§å° */
      input,
      select,
      textarea,
      option {
        font-size: 16px; /* æ¨è–¦æ‰‹æ©Ÿå®‰å…¨å­—é«”å¤§å°ï¼Œé¿å… iOS è‡ªå‹•æ”¾å¤§ */
        line-height: 1.4; /* è¡Œé«˜ç¨å¾®åŠ é«˜ä¸€é»ï¼Œé–±è®€æ›´èˆ’æœ */
      }
      button {
        font-size: 15px;
      }
      body {
        margin: 0;
        background: var(--app-bg);
        color: var(--text);
        display: flex;
        justify-content: center;
        padding: 16px;
      }
      .container {
        width: 100%;
        max-width: 480px;
        position: relative;
        display: none;
      }

      /* æ¨™é¡Œ */
      h1 {
        display: inline-flex; /* åŸæœ¬æ˜¯ flex */
        align-items: center;
        justify-content: center;
        gap: 10px;
        font-size: 24px;
        margin: 6px 0 10px;
        padding: 4px 10px;
        color: #444;
        border-radius: 8px;
        transition: background-color 0.2s, box-shadow 0.2s;
      }

      h1:hover {
        background: rgba(0, 0, 0, 0.05);
        box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.08) inset;
      }

      /* â‹¯ */
      /* â‹¯ æŒ‰éˆ•æœ¬èº«ï¼ˆåŸç‰ˆï¼‰ */
      /* â‹¯ æµ®éˆ•ï¼ˆåŸç‰ˆå°ºå¯¸/é™°å½±ï¼‰ */
      .more-btn {
        position: fixed;
        top: 12px;
        left: 12px;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #fff;
        color: #555;
        font-size: 18px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        z-index: 100;
        line-height: 1;
      }

      /* æ›´å¤šåŠŸèƒ½ï¼šå°å¡ç‰‡å¯¬åº¦èˆ‡ç·Šå¯¦æ¨™é¡Œ */
      #moreModal .modal-content {
        max-width: 300px;
      }
      #moreModal .modal-content h3 {
        margin: 0.2rem 0 0.6rem;
        font-size: 1.1rem;
      }
      .more-row-inline {
        justify-content: flex-start !important;
        gap: 0.75rem;
      }

      /* row ä½ˆå±€ï¼šå·¦æ–‡å³éˆ• */
      .more-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        margin: 10px 0;
      }

      /* å°æ·ºåº•ï¼šèª¿è‰²ç›¤æŒ‰éˆ• */
      button.palette-btn {
        display: inline-flex !important;
        align-items: center;
        justify-content: center;
        padding: 4px 8px !important;
        font-size: 0.85rem !important;
        font-weight: normal;
        border: 1px solid #ddd;
        border-radius: 6px;
        background: #f9f9f9 !important;
        color: #333 !important;
        width: auto !important;
        min-width: unset !important;
        margin-top: 0; /* ä¿æŒç·Šè²¼æ¨™é¡Œ */
      }
      button.palette-btn:hover {
        background: #f1f1f1 !important;
      }
      button.palette-btn:active {
        background: #e8e8e8 !important;
      }

      /* èª¿è‰²ç›¤ä¹å®®æ ¼ */
      /* --- èª¿è‰²ç›¤æŒ‰éˆ•ï¼ˆå°æ·ºåº•ï¼‰å·²åœ¨ä½ æª”æ¡ˆå…§ï¼Œä¿ç•™å³å¯ --- */

      /* èª¿è‰²ç›¤ä¹å®®æ ¼ï¼ˆä½ å·²æœ‰ï¼Œé€™è£¡è£œè¶³ data-color èƒŒæ™¯èˆ‡é¸å–æ…‹ï¼‰ */
      .palette-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.75rem;
        margin-top: 0.5rem;
      }
      .palette-choice {
        position: relative;
        width: 100%;
        aspect-ratio: 1/1;
        border-radius: 12px;
        border: 1px solid #e5e5e5;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
        cursor: pointer;
        overflow: hidden;
      }
      .palette-choice[data-color="#f6fbfe"] {
        background: #f6fbfe;
      }
      .palette-choice[data-color="#f3fcf8"] {
        background: #f3fcf8;
      }
      .palette-choice[data-color="#fffcf3"] {
        background: #fffcf3;
      }
      .palette-choice[data-color="#fef6f9"] {
        background: #fef6f9;
      }
      .palette-choice[data-color="#f9f8fd"] {
        background: #f9f8fd;
      }
      .palette-choice[data-color="#ffeded"] {
        background: #ffeded;
      }
      .palette-choice[data-color="#fff8f5"] {
        background: #fff8f5;
      }
      .palette-choice[data-color="#fdfcf9"] {
        background: #fdfcf9;
      }
      .palette-choice[data-color="metal"] {
        background: #e5e5e5;
      }
      .palette-choice .metal-sheen {
        position: absolute;
        inset: 0;
        background: linear-gradient(
            135deg,
            rgba(255, 255, 255, 0.35),
            rgba(255, 255, 255, 0.1)
          ),
          repeating-linear-gradient(
            90deg,
            rgba(255, 255, 255, 0.08) 0 1px,
            rgba(0, 0, 0, 0.04) 1px 2px
          );
        mix-blend-mode: screen;
        pointer-events: none;
      }
      .palette-choice.selected {
        outline: 3px solid #176dff;
        box-shadow: 0 0 0 3px rgba(23, 109, 255, 0.15) inset;
      }

      /* èª¿è‰²ç›¤åº•éƒ¨ï¼šç¢ºèªï¼å–æ¶ˆï¼ˆèˆ‡ MyTask é¢¨æ ¼ä¸€è‡´ï¼‰ */
      .dialog-actions {
        display: flex;
        gap: 0.5rem;
        margin-top: 12px;
      }
      .btn-primary,
      .btn-secondary {
        flex: 1;
        height: 42px;
        border-radius: 8px;
        font-weight: 700;
        font-size: 15px;
        cursor: pointer;
        border: 0;
        margin-top: 1rem;
      }
      .btn-primary {
        background: #fc97ba;
        color: #fff;
        box-shadow: 0 6px 16px rgba(0, 170, 255, 0.28);
      }
      .btn-primary:hover {
        background: #ffa49c;
      }
      .btn-primary:active {
        transform: translateY(1px);
      }

      .btn-secondary {
        background: #f5f5f5;
        color: #333;
        border: 1px solid #ddd;
      }
      .btn-secondary:hover {
        background: #eee;
      }

      /* æ›´å¤šåŠŸèƒ½å…§çš„è¡Œæ’åˆ—ï¼šå·¦æ–‡å³éˆ• */
      .more-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        margin: 10px 0;
      }

      /* æ¨™é¡Œæ›´ç·Šå¯¦ä¸€äº›ï¼ŒåƒåŸç‰ˆ */
      #moreModal .modal-content h3 {
        margin: 0.2rem 0 0.6rem;
        font-size: 1.1rem;
      }

      /* è—è‰²å¤§æŒ‰éˆ•ï¼šç™»å‡º */
      .logout-btn {
        width: 100%;
        height: 46px;
        background: #00aaff; /* ä¸»è— */
        color: #fff;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 800;
        cursor: pointer;
        box-shadow: 0 6px 16px rgba(0, 170, 255, 0.28);
      }
      .logout-btn:hover {
        background: #0791e6;
      }
      .logout-btn:active {
        transform: translateY(1px);
      }

      /* æ¨™é¡Œé–“è·ï¼ˆçœ‹èµ·ä¾†è·ŸåŸç‰ˆä¸€æ¨£ç·Šå¯¦ï¼‰ */
      #moreModal .modal-content h3 {
        margin: 0.2rem 0 0.6rem;
        font-size: 1.1rem;
      }

      /* ä»Šæ—¥å¾½ç« ï¼ˆå³ä¸Šè§’è¼•é‡ï¼‰ */
      #today-badge {
        position: fixed;
        top: 14px;
        right: 12px;
        z-index: 90;
        padding: 4px 8px;
        border-radius: 6px;
        background: rgba(255, 255, 255, 0.4);
        backdrop-filter: blur(6px);
        color: rgba(50, 50, 50, 0.85);
        font-size: 14px;
        font-weight: 500;
        letter-spacing: 0.3px;
        pointer-events: none;
      }

      /* å€å¡Š/å¡ç‰‡ */
      .section {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
        padding: 1rem;
        margin-bottom: 1rem;
      }
      .section-title {
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
      }
      .task {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--yellow-light);
        padding: 0.75rem 1rem;
        border-radius: 8px;
        margin-bottom: 0.5rem;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        touch-action: pan-y;
      }
      .task-content {
        flex: 1;
      }
      .task-title {
        font-size: 1.2rem;
        font-weight: 600;
      }

      .task .task-preview {
        font-size: 0.9rem;
        color: #666;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      /* é€²åº¦æ¢ï¼ˆæ»‘å‹•ï¼‰â€” åªä¿ç•™å·¦å´åˆªé™¤ */
      .swipe-bar {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 0%;
        display: flex;
        align-items: center;
        pointer-events: none;
        transition: width 0.18s;
      }
      .swipe-bar.left {
        right: 0;
        justify-content: flex-end;
        background: #ffe4e6;
        color: #5c2020;
      }
      .swipe-bar .label {
        font-weight: 800;
        opacity: 0;
        transition: opacity 0.12s, transform 0.12s;
        transform: translateX(6px);
        margin: 0 12px;
      }

      /* FAB */
      .fab {
        position: fixed;
        bottom: 24px;
        right: 24px;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0, 170, 255, 0.85) !important;
        color: #fff;
        font-size: 28px;
        font-weight: 700;
        box-shadow: 0 10px 22px rgba(0, 0, 0, 0.18);
        cursor: pointer;
        z-index: 110;
        transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease,
          background-color 0.2s ease;
      }
      .fab:hover {
        background: rgba(0, 170, 255, 0.95) !important;
      }
      .fab:active {
        transform: scale(0.98);
      }
      .fab.open {
        transform: rotate(45deg);
      }

      /* ç»ç’ƒå¡é¸å–® */
      .menu {
        position: fixed;
        bottom: 88px;
        right: 24px;
        min-width: 100px;
        padding: 8px;
        border-radius: 14px;
        background: rgba(255, 255, 255, 0.72);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(180, 210, 255, 0.35);
        box-shadow: 0 12px 28px rgba(0, 60, 130, 0.12);
        display: block; /* ç”¨é€æ˜æ§åˆ¶é¡¯ç¤º */
        opacity: 0;
        transform: translateY(8px) scale(0.98);
        pointer-events: none;
        z-index: 105;
      }
      .menu.show {
        opacity: 1;
        transform: translateY(0) scale(1);
        pointer-events: auto;
        transition: opacity 0.18s ease, transform 0.18s ease;
      }
      .menu button {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        width: 100%;
        background: transparent;
        border: 0;
        padding: 10px 12px;
        border-radius: 10px;
        font-size: 15px;
        font-weight: 600;
        color: #176dff; /* æ·ºè—ç³»ä¸»è‰² */
        letter-spacing: 0.2px;
        cursor: pointer;
      }
      .menu button:hover {
        background: linear-gradient(0deg, #eef6ff, #f7fbff);
      }
      .menu button:active {
        transform: translateY(1px);
      }
      .menu button + button {
        margin-top: 4px;
      }
      .menu::after {
        content: "";
        position: absolute;
        right: 12px;
        bottom: -6px;
        width: 12px;
        height: 12px;
        background: rgba(255, 255, 255, 0.72);
        border: 1px solid rgba(180, 210, 255, 0.35);
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
        box-shadow: 4px 4px 10px rgba(0, 60, 130, 0.06);
      }

      /* Modal */
      .modal {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.3);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 200;
      }
      .modal-content {
        width: 90%;
        max-width: 420px;
        background: #fff;
        border-radius: 12px;
        padding: 14px;
        position: relative;
      }
      .close-btn {
        position: absolute;
        right: 12px;
        top: 12px;
        width: 28px;
        height: 28px;
        border: 0;
        border-radius: 50%;
        background: #eee;
        cursor: pointer;
      }

      .modal-content label {
        display: block;
        margin-top: 0.5rem;
        font-size: 0.95rem;
      }
      .modal-content input:not([type="checkbox"]),
      .modal-content select,
      .modal-content textarea {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ccc;
        border-radius: 6px;
        margin-top: 0.25rem;
        font-size: 16px;
      }
      .inline-row {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-top: 0.25rem;
      }
      .half {
        width: 50%;
        min-width: 160px;
      }
      .important-flag {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        white-space: nowrap;
      }

      .save-btn {
        width: 100%;
        padding: 0.6rem;
        border: 0;
        border-radius: 6px;
        background: #77d4bc;
        color: #fff;
        cursor: pointer;
        font-weight: 600;
        margin-top: 1rem;
        font-size: 16px;
      }
      .row-btns {
        display: flex;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }
      .btn-half {
        flex: 1;
        padding: 0.6rem;
        border: 0;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 700;
      }
      .btn-save {
        background: #e8faf3;
        color: #176d59;
        border: 1px solid #ccefe2;
      }
      .btn-del {
        background: #fff3f3;
        color: #b23b3b;
        border: 1px solid #ffd8d8;
      }

      /* Login */
      #loginPage {
        display: flex;
        min-height: 100vh;
        align-items: center;
        justify-content: center;
        background: #ebf5fc;
      }
      #loginCard {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        padding: 24px;
        width: 95%;
        max-width: 450px;
      }
      .login-input {
        width: 100%;
        height: 44px;
        padding: 0 12px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 16px;
        margin: 0.6rem 0 1rem;
      }
      .login-btn {
        width: 100%;
        height: 46px;
        background: #00aaff;
        color: #fff;
        border: 0;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
      }
      .login-btn:hover {
        background: #0791e6;
      }

      /* å¹³æ»‘éœ§é¢é‡‘å±¬æ•ˆæœï¼ˆç„¡æ ¼ç·šæ„Ÿï¼‰ */
      body.bg-metal::before {
        content: "";
        position: fixed;
        inset: 0;
        z-index: -1;
        pointer-events: none;

        /* æŸ”å…‰é«˜äº® + å‚ç›´åˆ·çµ²ç´‹è·¯ï¼ˆè¶…ç´°å¾®ï¼‰ */
        background-image: linear-gradient(
            135deg,
            rgba(255, 255, 255, 0.2),
            rgba(255, 255, 255, 0.12)
          ),
          repeating-linear-gradient(
            90deg,
            rgba(255, 255, 255, 0.03) 0px,
            rgba(255, 255, 255, 0.03) 1px,
            rgba(0, 0, 0, 0.02) 1px,
            rgba(0, 0, 0, 0.02) 2px
          );

        background-blend-mode: screen, normal;

        /* è®“ç´‹ç†æ¥µåº¦ç´°ç·»ï¼Œé¿å…ç¶²æ ¼æ„Ÿ */
        background-size: 100% 100%, 600px 100%;
        background-repeat: no-repeat, repeat;

        /* è¼•å¾®å°æ¯”èˆ‡é£½å’Œåº¦ï¼Œä¿ç•™é‡‘å±¬æ„Ÿ */
        filter: contrast(103%) saturate(97%);
      }

      /* å±•é–‹é–±è®€é¢æ¿ï¼ˆå«å¾©åŸ/é‡åš/è¤‡è£½ï¼‰ */
      #detailViewer {
        display: none;
      }
      #detailViewer.show {
        display: block;
      }
      #detailForm.hide {
        display: none;
      }
      .viewer-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 0.5rem;
      }
      .viewer-title {
        font-weight: 700;
      }
      .viewer-close {
        border: 1px solid #ddd;
        background: #f7f7f7;
        border-radius: 6px;
        padding: 0.35rem 0.6rem;
        cursor: pointer;
      }
      .viewer-toolbar {
        display: flex;
        gap: 0.4rem;
        margin: 0.1rem 0 0.4rem;
      }
      .vt-btn {
        border: 1px solid #ddd;
        background: #f8f8f8;
        border-radius: 6px;
        padding: 0.3rem 0.5rem;
        font-size: 1rem;
        cursor: pointer;
      }
      .viewer-body {
        width: 100%;
        min-height: 50vh;
        padding: 0.75rem;
        border: 1px solid #eee;
        border-radius: 8px;
        background: #fafafa;
        line-height: 1.6;
        font-size: 0.95rem;
        resize: both;
      }

      /* === ç·¨è¼¯æ¨¡å¼ï¼šæ¨™é¡Œè¡Œå¯æ”¾æŠŠæ‰‹/é‰›ç­†/åˆªé™¤ï¼ŒX å›ºå®šåœ¨æœ€å³ === */
      .section.edit-mode .rename-btn,
      .section.edit-mode .delete-btn {
        display: inline-flex !important;
      }

      .section-title {
        position: relative; /* è®“å³ä¸Šè§’ X å¯ä»¥çµ•å°å®šä½ */
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      /* æŠŠæ‰‹ */
      .drag-handle {
        cursor: grab;
        color: #888;
      }

      /* é‰›ç­†ï¼šè·Ÿåœ¨æ–‡å­—å¾Œï¼ˆä¸è¦çµ•å°å®šä½ï¼‰ */
      .rename-btn {
        position: static;
        border: 0;
        background: transparent;
        color: #999;
        cursor: pointer;
      }

      /* X åœ¨æœ€å³ä¸Šè§’ */
      .delete-btn {
        position: absolute;
        top: 0;
        right: 0;
        border: 0;
        background: transparent;
        color: #999;
        cursor: pointer;
        display: none; /* åªåœ¨ edit-mode é¡¯ç¤º */
      }

      /* è®“åˆ†é¡å€å¯è¢«è¼•è§¸å›é¥‹ */
      #section-container {
        -webkit-user-select: none;
        user-select: none;
        -webkit-touch-callout: none;
        touch-action: pan-y; /* å…è¨±ä¸Šä¸‹æ²å‹• */
      }

      /* é»å£“ä¸­çš„å¾®ç¸®æ•ˆæœ */
      .section.__pressed {
        transform: scale(0.985);
        transition: transform 120ms ease;
      }

      /* é»ä¸€ä¸‹çš„å°å½ˆè·³æ•ˆæœ */
      @keyframes __bump {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(0.985);
        }
        100% {
          transform: scale(1);
        }
      }
      .section.__bump {
        animation: __bump 0.18s ease;
      }

      #loadingScreen {
        position: fixed;
        inset: 0;
        z-index: 9999;
        display: none;
        align-items: center;
        justify-content: center;
        background: var(--app-bg);
      }
      #loadingScreen .loading-wrap {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        padding: 16px 20px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(8px);
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
      }
      .loading-spinner {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        border: 3px solid rgba(0, 0, 0, 0.15);
        border-top-color: rgba(0, 0, 0, 0.5);
        animation: spin 0.9s linear infinite;
      }
      .loading-text {
        color: #444;
        font-weight: 600;
        letter-spacing: 0.2px;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* åŠ åœ¨ä½ çš„ <style> è£¡ */
      #app {
        display: none;
      } /* ç­‰é©—è­‰å®Œå†é¡¯ç¤º */

      /* è®“é€²åº¦æ¢å…§éƒ¨ä¸æœƒå› å¯¬åº¦è®Šå‹•è€Œæ›è¡Œ/è·³å‹• */
      .swipe-bar {
        overflow: hidden; /* å¯¬åº¦ä¸å¤ æ™‚æŠŠå·¦å´è¶…å‡ºéƒ¨åˆ†è£æ‰ */
      }

      .swipe-bar .label {
        white-space: nowrap; /* ç¦æ­¢æ›è¡Œï¼ˆCJK ä¹Ÿä¸æ›ï¼‰ */
        flex: 0 0 auto; /* ä¸è¦è¢«å£“ç¸® */
        width: 72px; /* å›ºå®šä¸€å€‹å¯¬åº¦ï¼šğŸ—‘ +ã€Œç§»é™¤ã€å‰›å¥½å–®è¡Œ */
        text-align: right; /* æ–‡å­—é å³å°é½Šï¼Œè¦–è¦ºä¸Šè²¼è¿‘å³é‚Š */
        letter-spacing: 0.02em; /* å¯æœ‰å¯ç„¡ï¼šå¾®èª¿å­—è· */
      }

      /* å·²ç§»é™¤ï¼šæ·ºè‰²æ¯›ç»ç’ƒå¡ç‰‡ */
      .task.removed {
        background: rgba(255, 255, 255, 0.55);
        backdrop-filter: blur(8px) saturate(1.05);
        -webkit-backdrop-filter: blur(8px) saturate(1.05);
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      }
      .task.removed .task-title {
        color: #555;
        font-weight: 600;
      }

      /* åœ¨ã€Œå·²ç§»é™¤ã€æª¢è¦–æ™‚ï¼Œå¼·åˆ¶é¡¯ç¤ºåˆ†é¡å³ä¸Šè§’çš„ X */
      #app.view-removed .section .delete-btn {
        display: inline-flex !important;
      }

      /* ã€Œå·²ç§»é™¤ã€æª¢è¦–æ™‚ï¼Œå³ä¸‹ï¼‹æ¡åç°åŠé€æ˜ï¼ˆä¸”ä¸å¯é»ï¼‰ */
      .fab.fab-disabled {
        opacity: 0.38;
        filter: grayscale(100%);
        background: rgba(200, 200, 200, 0.5) !important;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
        pointer-events: none;
      }

      /* é è¨­ä¸é¡¯ç¤ºå‚™å¿˜æ‹–æ‹‰æŠŠæ‰‹ */
      .memo-drag {
        display: none;
      }

      /* åªæœ‰ç·¨è¼¯ä¸­æ‰é¡¯ç¤ºæŠŠæ‰‹ */
      #app.editing .memo-drag {
        display: inline-flex;
        margin-right: 6px;
        color: #888;
        cursor: grab;
      }

      /* ç·¨è¼¯ä¸­å…è¨±æ‹–æ‹‰å¡ç‰‡ï¼ˆé¿å…å…ˆå‰æŠŠ .task è¨­æˆ pointer-events:noneï¼‰ */
      #app.editing .task {
        pointer-events: auto;
        cursor: grab;
      }

      /* ===== æœå°‹æ¬„ï¼ˆæ”¾åœ¨ moreModal è£¡ï¼‰ ===== */
      #moreModal .modal-content {
        position: relative;
      }
      .search-wrap {
        max-width: 200px;
        margin: 0 auto 0.25rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 0 0 0.25rem 0;
        padding: 10px 12px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.86);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(180, 210, 255, 0.35);
        box-shadow: 0 8px 20px rgba(0, 60, 130, 0.08);
        margin-bottom: 1rem;
      }
      .search-ico {
        font-size: 1rem;
        opacity: 0.7;
        transform: translateY(1px);
        pointer-events: none;
      }
      #taskSearchInput {
        flex: 1;
        height: 24px;
        border: 0;
        outline: none;
        background: transparent;
        font-size: 12px;
      }
      #taskSearchInput::placeholder {
        color: #9aa7bd;
      }
      .search-clear {
        border: 0;
        background: #eef3ff;
        color: #4a6aa8;
        width: 20px;
        height: 20px;
        font-size: 12px;
        border-radius: 50%;
        cursor: pointer;
        font-weight: 700;
        line-height: 1;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
      }
      .search-clear:active {
        transform: translateY(1px);
      }

      /* æœå°‹éš±è—ï¼ˆä¸å½±éŸ¿å…¶å®ƒç¯©é¸ï¼Œèƒ½ç–ŠåŠ ï¼‰ */
      .task.search-hide {
        display: none !important;
      }

      /* åªè®“ #memoContent æœ‰æœ€å°é«˜åº¦ï¼›ä¿ç•™å³ä¸‹è§’å¯èª¿æ•´ */
      /* æ”¾åœ¨æ‰€æœ‰ CSS çš„æœ€å¾Œé¢ */
      #memoModal #memoContent,
      #detailModal #detailContent {
        height: auto !important; /* é¿å…å…¶ä»–è¦å‰‡çµ¦äº†å›ºå®šé«˜åº¦ */
        min-height: 20svh; /* æ–°ç‰ˆ iOS/Androidï¼šå°è¦–çª—é«˜ */
        min-height: 20dvh; /* å‹•æ…‹è¦–çª—é«˜ï¼ˆå·¥å…·åˆ—æ”¶å±•æ™‚æ›´æº–ï¼‰ */
        min-height: 20vh; /* å‚™æ´ï¼šä¸€èˆ¬ç€è¦½å™¨ */
        resize: both !important;
        box-sizing: border-box;
      }
    </style>
  </head>
  <body>
    <!-- æ”¾åœ¨ <body> è£¡ã€#app ä¹‹å‰ -->
    <div
      id="autologin-overlay"
      aria-hidden="true"
      style="
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.72);
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        z-index: 260;
      "
    >
      <div
        style="
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.75rem;
          padding: 16px 18px;
          border-radius: 14px;
          background: rgba(255, 255, 255, 0.9);
          border: 1px solid rgba(180, 210, 255, 0.35);
          box-shadow: 0 12px 28px rgba(0, 60, 130, 0.12);
        "
      >
        <div
          style="
            width: 42px;
            height: 42px;
            border-radius: 50%;
            border: 3px solid #e6f4ff;
            border-top-color: #00aaff;
            animation: spin 0.8s linear infinite;
          "
        ></div>
        <div
          style="
            font-weight: 700;
            letter-spacing: 0.3px;
            color: #176dff;
            font-size: 14px;
          "
        >
          åˆ‡æ›ä¸­â€¦
        </div>
      </div>
    </div>

    <style>
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>

    <!-- App -->
    <div class="container" id="app">
      <div class="more-btn" onclick="openModal('moreModal')">â‹¯</div>
      <div id="today-badge"></div>

      <div style="text-align: center">
        <h1 onclick="location.href='index.html'" style="cursor: pointer">
          <img
            src="https://cdn.jsdelivr.net/gh/a355226/kj-reminder@main/mymemo.png"
            alt="icon"
            width="40"
            style="transform: translateY(2px)"
          />
          MyMemo
        </h1>
      </div>

      <div id="section-container"></div>

      <div class="fab" onclick="toggleMenu()">ï¼‹</div>
      <div class="menu" id="menu">
        <button
          onclick="openMemoModal()"
          style="
            background: #e6f6fc;
            color: #0091cc;
            font-weight: 600;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            margin-bottom: 12px;
          "
        >
          æ–°å¢å‚™å¿˜
        </button>

        <button
          onclick="openCategoryModal()"
          style="
            background: #e9f9f1;
            color: #1fa87a;
            font-weight: 500;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            margin-bottom: 12px;
          "
        >
          æ–°å¢åˆ†é¡
        </button>

        <button
          onclick="enterEditMode()"
          style="
            background: #fff6e6;
            color: #d98a00;
            font-weight: 600;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
            cursor: pointer;
          "
        >
          ç·¨è¼¯åˆ†é¡
        </button>
      </div>
      <!-- âœ… ç·¨è¼¯å®Œæˆï¼ˆç½®ä¸­æ‡¸æµ®ï¼‰ -->
      <button
        id="exitEditBtn"
        onclick="exitEditMode()"
        style="
          display: none;
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          background: #e3ffe8;
          color: #176d59;
          border: none;
          border-radius: 8px;
          padding: 6px 14px;
          font-size: 13px;
          font-weight: bold;
          cursor: pointer;
          z-index: 120;
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        "
      >
        âœ…
      </button>
    </div>

    <!-- æ–°å¢å‚™å¿˜ -->
    <div class="modal" id="memoModal">
      <div class="modal-content">
        <button class="close-btn" onclick="closeModal('memoModal')">âœ•</button>
        <h3>æ–°å¢å‚™å¿˜</h3>

        <label>å‚™å¿˜åˆ†é¡</label>
        <div class="inline-row">
          <select id="memoSection" class="half"></select>
          <label class="important-flag"
            ><input type="checkbox" id="memoImportant" /> é‡è¦</label
          >
        </div>

        <label>å‚™å¿˜æ¨™é¡Œï¼ˆå¿…å¡«ï¼‰</label>
        <input type="text" id="memoTitle" />

        <label>å‚™å¿˜å…§å®¹</label>
        <textarea id="memoContent"></textarea>

        <button class="save-btn" onclick="addMemo()">æ–°å¢</button>
      </div>
    </div>

    <!-- è©³æƒ… -->
    <div class="modal" id="detailModal">
      <div class="modal-content">
        <button class="close-btn" onclick="closeModal('detailModal')">âœ•</button>
        <h3 style="display: flex; align-items: center; gap: 0.5rem">
          <span>å‚™å¿˜å…§å®¹</span>
          <small
            id="detailLastUpdate"
            style="font-size: 0.9rem; color: #666; white-space: nowrap"
          ></small>
        </h3>

        <!-- è¡¨å–® -->
        <div id="detailForm">
          <label>å‚™å¿˜åˆ†é¡</label>
          <div class="inline-row">
            <select id="detailSection" class="half"></select>
            <label class="important-flag"
              ><input type="checkbox" id="detailImportant" /> é‡è¦</label
            >
          </div>

          <label>å‚™å¿˜æ¨™é¡Œ</label>
          <input type="text" id="detailTitle" style="margin-bottom: 10px" />

          <div style="display: flex; align-items: center; gap: 0.4rem">
            <label for="detailContent" style="margin: 0">å‚™å¿˜å…§å®¹</label>
            <button
              type="button"
              class="expand-icon"
              onclick="event.stopPropagation(); toggleDetailExpand('detailContent','å‚™å¿˜å…§å®¹')"
              title="å±•é–‹"
              style="
                display: inline-flex;
                align-items: center;
                justify-content: center;
                width: 22px;
                height: 22px;
                margin-left: 0.4rem;
                border-radius: 4px;
                border: 1px solid #ddd;
                background: #f8f8f8;
                cursor: pointer;
                font-size: 12px;
                color: #555;
              "
            >
              â¤¢
            </button>
          </div>
          <textarea id="detailContent"></textarea>

          <div class="row-btns">
            <button class="btn-half btn-save" onclick="saveMemo()">
              ğŸ’¾ å„²å­˜
            </button>
            <button class="btn-half btn-del" onclick="confirmDelete()">
              ğŸ—‘ï¸ ç§»é™¤
            </button>
          </div>
        </div>

        <!-- å±•é–‹é–±è®€/ç·¨è¼¯å™¨ -->
        <div id="detailViewer">
          <div class="viewer-head">
            <div class="viewer-title" id="viewerTitle"></div>
            <button
              type="button"
              class="viewer-close"
              onclick="toggleDetailExpand()"
              style="margin-top: 6px"
            >
              â¤¢
            </button>
          </div>
          <div class="viewer-toolbar">
            <button class="vt-btn" title="é‚„åŸ" onclick="viewerUndo()">
              â¤º
            </button>
            <button class="vt-btn" title="å¾©åŸ" onclick="viewerRedo()">
              â¤»
            </button>
            <button class="vt-btn" title="è¤‡è£½" onclick="viewerCopy()">
              â§‰
            </button>
          </div>
          <textarea class="viewer-body" id="viewerBody"></textarea>
        </div>
      </div>
    </div>

    <!-- åˆªé™¤ç¢ºèª -->
    <div class="modal" id="confirmModal">
      <div class="modal-content">
        <h3 style="text-align: center">ç¢ºå®šè¦åˆªé™¤é€™å‰‡å‚™å¿˜ï¼Ÿ</h3>
        <div style="display: flex; gap: 0.75rem; margin-top: 1rem">
          <button class="btn-half btn-del" onclick="deleteMemo()">ç¢ºèª</button>
          <button
            class="btn-half btn-save"
            onclick="closeModal('confirmModal')"
          >
            å–æ¶ˆ
          </button>
        </div>
      </div>
    </div>

    <!-- åˆªé™¤ã€Œåˆ†é¡ã€ç¢ºèª -->
    <div class="modal" id="confirmCategoryModal">
      <div class="modal-content">
        <h3 style="text-align: center">ç¢ºå®šè¦åˆªé™¤æ­¤åˆ†é¡ï¼Ÿ</h3>
        <div style="display: flex; gap: 0.75rem; margin-top: 1rem">
          <button class="btn-half btn-del" onclick="deleteCategoryConfirmed()">
            ç¢ºèª
          </button>
          <button
            class="btn-half btn-save"
            onclick="closeModal('confirmCategoryModal')"
          >
            å–æ¶ˆ
          </button>
        </div>
      </div>
    </div>

    <!-- æ–°å¢åˆ†é¡ -->
    <div class="modal" id="categoryModal">
      <div class="modal-content">
        <button class="close-btn" onclick="closeModal('categoryModal')">
          âœ•
        </button>
        <h3>æ–°å¢åˆ†é¡</h3>
        <input type="text" id="newCategoryName" placeholder="è«‹è¼¸å…¥åˆ†é¡åç¨±" />
        <button class="save-btn" onclick="addCategory()">æ–°å¢åˆ†é¡</button>
      </div>
    </div>

    <!-- æ›´ååˆ†é¡ -->
    <div class="modal" id="renameModal">
      <div class="modal-content">
        <button class="close-btn" onclick="closeModal('renameModal')">âœ•</button>
        <h3>é‡å‘½ååˆ†é¡</h3>
        <input type="text" id="renameInput" placeholder="æ–°çš„åˆ†é¡åç¨±" />
        <button class="save-btn" onclick="confirmRename()">ç¢ºå®š</button>
      </div>
    </div>

    <!-- å¯†ç¢¼ï¼è§£é–ï¼å–æ¶ˆé–å®šç”¨å½ˆçª— -->
    <div id="lockModal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 420px">
        <h3 id="lockModalTitle">è¨­å®šå¯†ç¢¼</h3>
        <p id="lockModalDesc" style="color: #555; line-height: 1.6">
          è«‹è¼¸å…¥ 6
          ä½æ•¸å­—åšç‚ºæ­¤åˆ†é¡çš„å¯†ç¢¼ã€‚è«‹å‹™å¿…å¦¥å–„ä¿å­˜ï¼›æœ¬ç³»çµ±ä¸æä¾›å¿˜è¨˜å¯†ç¢¼åŠŸèƒ½ã€‚
        </p>

        <div style="margin: 10px 0">
          <input
            id="lockPasswordInput"
            type="password"
            inputmode="numeric"
            pattern="\d{6}"
            maxlength="6"
            placeholder="è¼¸å…¥å¯†ç¢¼"
            style="
              width: 100%;
              padding: 10px 12px;
              font-size: 16px;
              border: 1px solid #ddd;
              border-radius: 8px;
            "
          />
        </div>

        <div
          id="lockErrorHint"
          style="display: none; color: #d33; margin: 6px 0 0"
        ></div>

        <div style="display: flex; gap: 8px; margin-top: 14px">
          <button id="lockModalConfirmBtn" class="btn-half btn-save">
            ç¢ºèª
          </button>
          <button class="btn-half btn-del" onclick="closeModal('lockModal')">
            å–æ¶ˆ
          </button>
        </div>
      </div>
    </div>

    <!-- â‹¯ï¼ˆåªä¿ç•™æ›´æ›åº•è‰²èˆ‡ç™»å‡ºï¼‰ -->
    <!-- æ›´å¤šåŠŸèƒ½ Modalï¼ˆåŸç‰ˆæ¨£å¼ï¼‰ -->
    <div class="modal" id="moreModal">
      <div class="modal-content">
        <button class="close-btn" onclick="closeModal('moreModal')">âœ•</button>
        <!-- ğŸ” æœå°‹æ¬„ï¼ˆåªä¿ç•™å³å´ Xï¼‰ -->
        <div
          id="globalSearch"
          class="search-wrap modal-search"
          role="search"
          aria-label="æœå°‹ä»»å‹™"
        >
          <span class="search-ico" aria-hidden="true">ğŸ”</span>
          <input
            id="taskSearchInput"
            type="text"
            autocomplete="off"
            placeholder="åœ¨MyMemoä¸­æœå°‹"
            aria-label="æœå°‹æ¨™é¡Œã€ä»»å‹™å…§å®¹ã€è™•ç†æƒ…å½¢"
          />
          <button
            id="taskSearchClear"
            class="search-clear"
            aria-label="æ¸…é™¤æœå°‹"
          >
            âœ•
          </button>
        </div>
        <h3>å‚™å¿˜éŒ„æª¢è¦–</h3>
        <div class="more-row more-row-inline">
          <label style="display: flex; align-items: center; gap: 0.4rem">
            <input type="checkbox" id="viewActiveToggle" />ç•¶å‰</label
          >
          <label style="display: flex; align-items: center; gap: 0.4rem">
            <input type="checkbox" id="viewRemovedToggle" />å·²ç§»é™¤</label
          >
        </div>

        <h3>æ›´æ›åº•è‰²</h3>

        <div
          class="more-row"
          style="flex-direction: column; align-items: flex-start; gap: 0.5rem"
        >
          <button id="openPaletteBtn" class="palette-btn">ğŸ¨ èª¿è‰²ç›¤</button>
        </div>

        <hr style="margin: 1rem 0; border: none; border-top: 1px solid #eee" />

        <button class="logout-btn" onclick="openLogoutModal()">ç™»å‡º</button>
      </div>
    </div>

    <!-- èª¿è‰²ç›¤ -->
    <!-- èª¿è‰²ç›¤ï¼ˆåŸç‰ˆäº’å‹•ï¼šç¢ºèªï¼å–æ¶ˆï¼‰ -->
    <div class="modal" id="paletteModal">
      <div class="modal-content">
        <button class="close-btn" onclick="closeModal('paletteModal')">
          âœ•
        </button>
        <h3>é¸æ“‡åº•è‰²</h3>

        <div class="palette-grid">
          <div class="palette-choice" data-color="#f6fbfe"></div>
          <div class="palette-choice" data-color="#f3fcf8"></div>
          <div class="palette-choice" data-color="#fffcf3"></div>
          <div class="palette-choice" data-color="#fef6f9"></div>
          <div class="palette-choice" data-color="#f9f8fd"></div>
          <div class="palette-choice" data-color="#ffeded"></div>
          <div class="palette-choice" data-color="#fff8f5"></div>
          <div class="palette-choice" data-color="#fdfcf9"></div>
          <div class="palette-choice" data-color="metal">
            <div class="metal-sheen"></div>
          </div>
        </div>

        <div class="dialog-actions">
          <button id="paletteConfirmBtn" class="btn-primary">ç¢ºèª</button>
          <button id="paletteCancelBtn" class="btn-secondary">å–æ¶ˆ</button>
        </div>
      </div>
    </div>

    <!-- ç™»å‡ºç¢ºèª -->
    <div class="modal" id="logoutModal">
      <div class="modal-content">
        <h3 style="text-align: center">ç¢ºå®šè¦ç™»å‡ºï¼Ÿ</h3>
        <div style="display: flex; gap: 0.75rem; margin-top: 1rem">
          <button class="btn-half btn-del" onclick="doLogout()">ç¢ºèª</button>
          <button class="btn-half btn-save" onclick="closeModal('logoutModal')">
            å–æ¶ˆ
          </button>
        </div>
      </div>
    </div>

    <script src="./app2.js" defer></script>

    <!-- é¦–å±å¥—ç”¨ä½¿ç”¨è€…é¸çš„åº•è‰²ï¼ˆè¶…ç²¾ç°¡ç‰ˆï¼‰ -->
    <script>
      (function () {
        try {
          var saved = localStorage.getItem("app_bg_fixed"); // ä½ åŸæœ¬å­˜çš„ key
          if (!saved) return;
          var c = saved === "metal" ? "#ececec" : saved; // metal å…ˆç”¨å¯¦è‰²å¢Šåº•
          var st = document.createElement("style");
          st.textContent =
            ":root{--app-bg:" + c + "}html,body{background:" + c + "}";
          document.head.appendChild(st);
          // å¯é¸ï¼šåŒæ­¥ç€è¦½å™¨åœ°å€åˆ—é¡è‰²ï¼Œæ¸›å°‘ iOS/Android é‚Šæ¢é–ƒçˆ
          var meta =
            document.querySelector('meta[name="theme-color"]') ||
            document.createElement("meta");
          meta.name = "theme-color";
          meta.content = c;
          if (!meta.parentNode) document.head.appendChild(meta);
        } catch (e) {}
      })();
    </script>

    <!-- Loadingï¼ˆåˆ‡æ›ä¸­ï¼‰ -->
    <div id="loadingScreen" style="display: none">
      <div class="loading-wrap">
        <div class="loading-spinner"></div>
        <div class="loading-text">åˆ‡æ›ä¸­â€¦</div>
      </div>
    </div>
  </body>
</html>
